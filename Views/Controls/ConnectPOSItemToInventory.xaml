<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Coftea_Capstone.Views.Controls.ConnectPOSItemToInventory"
             BackgroundColor="#80000000"
             IsVisible="{Binding IsConnectPOSToInventoryVisible}"
             HorizontalOptions="FillAndExpand"
             VerticalOptions="FillAndExpand"
             Padding="0">

    <!-- Popup Background -->
    <Grid HorizontalOptions="FillAndExpand"
          VerticalOptions="FillAndExpand"
          RowDefinitions="*,Auto,*"
          ColumnDefinitions="*,Auto,*">

        <!-- Transparent Click-Close Overlay -->
        <BoxView Grid.RowSpan="3" Grid.ColumnSpan="3"
                 BackgroundColor="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding CloseConnectPOSToInventoryCommand}" />
            </BoxView.GestureRecognizers>
        </BoxView>

        <!-- Center Popup -->
        <Frame Grid.Row="1" Grid.Column="1"
               CornerRadius="25"
               Padding="0"
               WidthRequest="1006"
               HeightRequest="720"
               BackgroundColor="#F8E8D7"
               HasShadow="True"
               BorderColor="#DDDDDD"
               TranslationY="10">

            <!-- MAIN GRID FOR HEADER, CONTENT, FOOTER -->
            <Grid Padding="25" RowSpacing="15"
                  RowDefinitions="Auto,*,Auto">

                <!-- HEADER -->
                <HorizontalStackLayout Grid.Row="0" VerticalOptions="Start" HorizontalOptions="FillAndExpand">
                    <Label Text="Connect POS to Inventory"
                           FontAttributes="Bold"
                           FontSize="26"
                           TextColor="#3C3C3C"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>

                <!-- CONTENT SECTION -->
                <ScrollView Grid.Row="1">
                    <VerticalStackLayout Spacing="15">

                        <!-- Divider -->
                        <BoxView HeightRequest="1" Color="#DDD" />

                        <!-- Filter / Sort Controls -->
                        <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
                            <HorizontalStackLayout Spacing="10" Padding="5,0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="3"/>
                                    </Grid.RowDefinitions>
                                    <Button Grid.Row="0" Text="All" TextColor="Black" FontAttributes="Bold" BackgroundColor="#FFEAD6" WidthRequest="100" Command="{Binding FilterByCategoryCommand}" CommandParameter="All">
                                        <Button.Triggers>
                                            <DataTrigger TargetType="Button" Binding="{Binding SelectedFilter}" Value="All">
                                                <Setter Property="BackgroundColor" Value="#D4A574" />
                                                <Setter Property="TextColor" Value="White" />
                                            </DataTrigger>
                                        </Button.Triggers>
                                    </Button>
                                    <BoxView Grid.Row="1" HeightRequest="3" BackgroundColor="#D4A574" CornerRadius="1.5">
                                        <BoxView.Triggers>
                                            <DataTrigger TargetType="BoxView" Binding="{Binding SelectedFilter}" Value="All">
                                                <Setter Property="IsVisible" Value="True" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="BoxView" Binding="{Binding SelectedFilter}" Value="Ingredients">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="BoxView" Binding="{Binding SelectedFilter}" Value="Supplies">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                        </BoxView.Triggers>
                                    </BoxView>
                                </Grid>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="3"/>
                                    </Grid.RowDefinitions>
                                    <Button Grid.Row="0" Text="Ingredients" TextColor="Black" FontAttributes="Bold" FontSize="13" BackgroundColor="#FFEAD6" WidthRequest="135" Command="{Binding FilterByCategoryCommand}" CommandParameter="Ingredients">
                                        <Button.Triggers>
                                            <DataTrigger TargetType="Button" Binding="{Binding SelectedFilter}" Value="Ingredients">
                                                <Setter Property="BackgroundColor" Value="#D4A574" />
                                                <Setter Property="TextColor" Value="White" />
                                            </DataTrigger>
                                        </Button.Triggers>
                                    </Button>
                                    <BoxView Grid.Row="1" HeightRequest="3" BackgroundColor="#D4A574" CornerRadius="1.5">
                                        <BoxView.Triggers>
                                            <DataTrigger TargetType="BoxView" Binding="{Binding SelectedFilter}" Value="Ingredients">
                                                <Setter Property="IsVisible" Value="True" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="BoxView" Binding="{Binding SelectedFilter}" Value="All">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="BoxView" Binding="{Binding SelectedFilter}" Value="Supplies">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                        </BoxView.Triggers>
                                    </BoxView>
                                </Grid>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="3"/>
                                    </Grid.RowDefinitions>
                                    <Button Grid.Row="0" Text="Supplies" TextColor="Black" FontAttributes="Bold" BackgroundColor="#FFEAD6" WidthRequest="120" Command="{Binding FilterByCategoryCommand}" CommandParameter="Supplies">
                                        <Button.Triggers>
                                            <DataTrigger TargetType="Button" Binding="{Binding SelectedFilter}" Value="Supplies">
                                                <Setter Property="BackgroundColor" Value="#D4A574" />
                                                <Setter Property="TextColor" Value="White" />
                                            </DataTrigger>
                                        </Button.Triggers>
                                    </Button>
                                    <BoxView Grid.Row="1" HeightRequest="3" BackgroundColor="#D4A574" CornerRadius="1.5">
                                        <BoxView.Triggers>
                                            <DataTrigger TargetType="BoxView" Binding="{Binding SelectedFilter}" Value="Supplies">
                                                <Setter Property="IsVisible" Value="True" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="BoxView" Binding="{Binding SelectedFilter}" Value="All">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="BoxView" Binding="{Binding SelectedFilter}" Value="Ingredients">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                        </BoxView.Triggers>
                                    </BoxView>
                                </Grid>
                                <Button Text="ðŸ”„ Refresh" 
                                        BackgroundColor="#D4A574" 
                                        TextColor="White" 
                                        BorderColor="#8B7355"
                                        BorderWidth="2"
                                        FontAttributes="Bold"
                                        FontSize="13"
                                        HeightRequest="40"
                                        WidthRequest="100"
                                        CornerRadius="20"
                                        Padding="10,0"
                                        Command="{Binding RefreshInventoryCommand}"/>

                                <!-- Sort -->
                                <Frame CornerRadius="12" Padding="8,0" BackgroundColor="White" HasShadow="False" VerticalOptions="Center">
                                    <Picker Title="Sort By" 
                                            SelectedItem="{Binding SelectedSort}" 
                                            FontSize="14"
                                            TextColor="Black">
                                        <Picker.Items>
                                            <x:String>Name (A-Z)</x:String>
                                            <x:String>Name (Z-A)</x:String>
                                            <x:String>Quantity (Low to High)</x:String>
                                            <x:String>Quantity (High to Low)</x:String>
                                        </Picker.Items>
                                    </Picker>
                                </Frame>

                                <!-- Search -->
                                <Frame CornerRadius="12" Padding="0" BackgroundColor="White" HasShadow="False" VerticalOptions="Center">
                                    <SearchBar Placeholder="Search"
                                               WidthRequest="220"
                                               Text="{Binding SearchText}"
                                               TextColor="Black"
                                               BackgroundColor="Transparent"
                                               FontSize="16"/>
                                </Frame>

                                <Button Text="âœ• Unselect All" 
                                        Command="{Binding UnselectAllVisibleCommand}" 
                                        BackgroundColor="#BDAEA2" 
                                        TextColor="#5B4F45" 
                                        BorderColor="#8B7355"
                                        BorderWidth="2"
                                        FontSize="13"
                                        FontFamily="OpenSans-Semibold"
                                        FontAttributes="Bold"
                                        HeightRequest="40"
                                        WidthRequest="120"
                                        CornerRadius="20"
                                        Padding="10,0"/>
                            </HorizontalStackLayout>
                        </ScrollView>

                        <!-- Inventory Content -->
                        <Frame BackgroundColor="White"
                               CornerRadius="15"
                               HasShadow="True"
                               Padding="0">
                            <VerticalStackLayout Spacing="10" Padding="20">

                                <VerticalStackLayout Spacing="8">
                                    <Label Text="SELECT FROM INVENTORY"
                                           FontAttributes="Bold"
                                           FontSize="18"
                                           TextColor="#3C3C3C" />
                                    <Frame BackgroundColor="#E8F5E8"
                                           CornerRadius="8"
                                           Padding="12,8"
                                           HasShadow="False">
                                        <HorizontalStackLayout Spacing="8">
                                            <Label Text="â„¹"
                                                   FontSize="16"
                                                   TextColor="#2E7D32"
                                                   VerticalOptions="Center"/>
                                            <Label Text="Cups are size-specific (Small Cup for Small, Medium Cup for Medium, Large Cup for Large). Straws are included for all sizes."
                                                   FontSize="13"
                                                   TextColor="#2E7D32"
                                                   VerticalOptions="Center"/>
                                        </HorizontalStackLayout>
                                    </Frame>
                                </VerticalStackLayout>

                                <!-- Table Header -->
                                <Grid ColumnDefinitions="1*,1*,2*" BackgroundColor="#DAAB97" Padding="12,6" >
                                    <Label Grid.Column="0" Text="ITEMS" FontAttributes="Bold" TextColor="White"/>
                                    <Label Grid.Column="1" Text="CATEGORY" FontAttributes="Bold" TextColor="White"/>
                                    <Label Grid.Column="2" Text="STOCKS" FontAttributes="Bold" TextColor="White"/>
                                </Grid>

                                <!-- Scrollable Inventory List -->
                                <CollectionView ItemsSource="{Binding InventoryItems}"
                                                VerticalOptions="Start"
                                                SelectionMode="None">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Frame BackgroundColor="#FAFAFA"
                                                   CornerRadius="10"
                                                   Padding="10"
                                                   Margin="0,5"
                                                   HasShadow="False">
                                                <Grid ColumnDefinitions="1*,1*,2*">
                                                    <Grid.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentView}}, Path=BindingContext.ToggleSelectCommand}" CommandParameter="{Binding .}" />
                                                    </Grid.GestureRecognizers>

                                                    <!-- Checkbox + Image + Name -->
                                                    <HorizontalStackLayout Grid.Column="0" Spacing="10" VerticalOptions="Center">
                                                        <CheckBox IsChecked="{Binding IsSelected}" 
                                                                  Color="Black" 
                                                                  MinimumWidthRequest="24" 
                                                                  MinimumHeightRequest="24" />
                                                        <Frame WidthRequest="36" HeightRequest="36" CornerRadius="8" Padding="0" HasShadow="False" BackgroundColor="#EFEFEF">
                                                            <Image Source="{Binding ImageSource}" Aspect="AspectFill"/>
                                                        </Frame>
                                                        <Label Text="{Binding itemName}" VerticalOptions="Center" FontSize="14" TextColor="Black"/>
                                                    </HorizontalStackLayout>

                                                    <!-- Category -->
                                                    <Label Grid.Column="1" Text="{Binding itemCategory}" VerticalOptions="Center" FontSize="13" TextColor="Black"/>

                                                    <!-- Stock Information -->
                                                    <VerticalStackLayout Grid.Column="2" Spacing="4" VerticalOptions="Center">
                                                        <Frame BackgroundColor="White" CornerRadius="10" Padding="8" HasShadow="True">
                                                            <Label FormattedText="{Binding NewStockDisplayFormatted}" 
                                                                   FontSize="13" 
                                                                   HorizontalOptions="Start" 
                                                                   VerticalOptions="Center"
                                                                   LineBreakMode="WordWrap"
                                                                   MaxLines="1" />
                                                        </Frame>
                                                    </VerticalStackLayout>
                                                </Grid>
                                            </Frame>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>

                            </VerticalStackLayout>
                        </Frame>

                    </VerticalStackLayout>
                </ScrollView>

                <!-- FOOTER -->
                <HorizontalStackLayout Grid.Row="2"
                                       HorizontalOptions="End"
                                       Spacing="15"
                                       Padding="0,10,0,10">
                    <Button Text="â† Return" 
                            BackgroundColor="#BDAEA2" 
                            TextColor="#5B4F45"
                            BorderColor="#8B7355"
                            BorderWidth="2"
                            FontSize="15"
                            FontAttributes="Bold"
                            Command="{Binding ReturnToAddItemToPOSCommand}" 
                            WidthRequest="140"
                            HeightRequest="50"
                            CornerRadius="20"/>
                    <Button Text="Next â†’" 
                            BackgroundColor="#5B4F45" 
                            TextColor="White"
                            BorderWidth="0"
                            FontSize="15"
                            FontAttributes="Bold"
                            Command="{Binding OpenInputIngredientsCommand}" 
                            WidthRequest="140"
                            HeightRequest="50"
                            CornerRadius="20"/>
                </HorizontalStackLayout>

            </Grid>
        </Frame>
    </Grid>
</ContentView>
