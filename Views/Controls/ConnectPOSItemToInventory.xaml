<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Coftea_Capstone.Views.Controls.ConnectPOSItemToInventory"
             BackgroundColor="#80000000"
             IsVisible="{Binding IsConnectPOSToInventoryVisible}"
             HorizontalOptions="FillAndExpand"
             VerticalOptions="FillAndExpand">

    <Grid HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
        <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="20">
            <HorizontalStackLayout Spacing="20">
                <!-- Left Frame: Selection (wider) -->
                <Frame BackgroundColor="#D8C4B6" CornerRadius="20" WidthRequest="900" HeightRequest="700" Padding="20">
                    <VerticalStackLayout Spacing="15">

                        <!-- Unified Frame: Selected + Inventory Selection -->
                        <Frame BackgroundColor="White" CornerRadius="10" Padding="10" HasShadow="False" HeightRequest="650">
                            <VerticalStackLayout Spacing="10">
                                <Label Text="SELECTED INVENTORY ITEMS" FontAttributes="Bold" FontSize="20"/>

                                <!-- Category buttons -->
                                <HorizontalStackLayout Spacing="10" VerticalOptions="Center" HorizontalOptions="Center">
                                    <Button Text="Addons" Command="{Binding FilterByCategoryCommand}" CommandParameter="Addons"/>
                                    <Button Text="Ingredients" Command="{Binding FilterByCategoryCommand}" CommandParameter="Ingredients"/>
                                    <Button Text="Supplies" Command="{Binding FilterByCategoryCommand}" CommandParameter="Supplies"/>
                                    <Button Text="Refresh" BackgroundColor="#D3D3D3" TextColor="Black" Command="{Binding RefreshInventoryCommand}"/>
                                    <Frame CornerRadius="10" BackgroundColor="White" Padding="5" WidthRequest="150" HeightRequest="36">
                                        <Picker Title="Sort By" SelectedItem="{Binding SelectedSort}">
                                            <Picker.Items>
                                                <x:String>Name (A-Z)</x:String>
                                                <x:String>Name (Z-A)</x:String>
                                                <x:String>Quantity (Low to High)</x:String>
                                                <x:String>Quantity (High to Low)</x:String>
                                            </Picker.Items>
                                        </Picker>
                                    </Frame>
                                    <SearchBar Placeholder="Search" WidthRequest="200" Text="{Binding SearchText}"/>
                                    <Button Text="Select All" Command="{Binding SelectAllVisibleCommand}"/>
                                </HorizontalStackLayout>

                                <Label Text="SELECT FROM INVENTORY" FontAttributes="Bold" FontSize="20"/>

                                <!-- Header -->
                                <Grid ColumnDefinitions="2*,1*,2*" BackgroundColor="#DAAB97" Padding="10,6">
                                    <Label Grid.Column="0" Text="ITEMS" HorizontalOptions="Start" FontAttributes="Bold"/>
                                    <Label Grid.Column="1" Text="CATEGORY" HorizontalOptions="Start" FontAttributes="Bold"/>
                                    <Label Grid.Column="2" Text="STOCKS" HorizontalOptions="Start" FontAttributes="Bold"/>
                                </Grid>

                                <!-- Data Rows (bounded height to keep footer visible) -->
                                <CollectionView ItemsSource="{Binding InventoryItems}" HeightRequest="420" VerticalOptions="Start">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid ColumnDefinitions="2*,1*,2*" Padding="10,6">
                                                <Grid.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentView}}, Path=BindingContext.ToggleSelectCommand}" CommandParameter="{Binding .}"/>
                                                </Grid.GestureRecognizers>

                                                <!-- Column 0: Checkbox + Image + Name -->
                                                <HorizontalStackLayout Grid.Column="0" Spacing="8" VerticalOptions="Center" HorizontalOptions="Start">
                                                    <CheckBox IsChecked="{Binding IsSelected}"/>
                                                    <Frame WidthRequest="30" HeightRequest="30" CornerRadius="6" Padding="0" HasShadow="False" BackgroundColor="#F0F0F0">
                                                        <Image Source="{Binding ImageSource}" Aspect="AspectFill"/>
                                                    </Frame>
                                                    <Label Text="{Binding itemName}" VerticalOptions="Center"/>
                                                </HorizontalStackLayout>

                                                <!-- Column 1: Category -->
                                                <Label Grid.Column="1" Text="{Binding itemCategory}" HorizontalOptions="Start" VerticalOptions="Center"/>

                                                <!-- Column 2: Stock info + Amount/Unit inputs -->
                                                <VerticalStackLayout Grid.Column="2" Spacing="6" VerticalOptions="Center">
                                                    <!-- Custom progress bar like Inventory -->
                                                    <Grid HeightRequest="20" VerticalOptions="Center">
                                                        <!-- Background -->
                                                        <BoxView Color="#E0E0E0" CornerRadius="10"/>

                                                        <!-- Green bar -->
                                                        <BoxView Color="#34C759" CornerRadius="10" HorizontalOptions="Start"
                                                                 WidthRequest="{Binding StockProgressWidth}" />

                                                        <!-- Overlay text -->
                                                        <Label Text="{Binding StockText}" 
                                                               FontSize="12" 
                                                               TextColor="Black" 
                                                               HorizontalOptions="Center" 
                                                               VerticalOptions="Center"/>
                                                    </Grid>
                                                </VerticalStackLayout>
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>

                                <!-- Footer actions -->
                                <HorizontalStackLayout HorizontalOptions="End" Spacing="20" Margin="0,10,0,0">
                                    <Button Text="Close" Command="{Binding CloseConnectPOSToInventoryCommand}"/>
                                    <Button Text="Return" BackgroundColor="#D3D3D3" TextColor="Black" Command="{Binding ReturnToAddItemToPOSCommand}"/>
                                    <Button Text="Next" BackgroundColor="#E6DE9D" TextColor="Black" Command="{Binding OpenInputIngredientsCommand}"/>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Frame>

                    </VerticalStackLayout>
                </Frame>
            </HorizontalStackLayout>
        </VerticalStackLayout>
    </Grid>
</ContentView>
