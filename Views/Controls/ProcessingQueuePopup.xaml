<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:Coftea_Capstone.ViewModel.Others"
             x:Class="Coftea_Capstone.Views.Controls.ProcessingQueuePopup"
             x:Name="Root"
             IsVisible="{Binding IsVisible}"
             BackgroundColor="#80000000">
    <ContentView.Resources>
        <ResourceDictionary>
            <converters:IsPositiveConverter x:Key="IsPositiveConverter"/>
            <converters:IndexOfInCollectionMultiConverter x:Key="IndexOfConverter" />
        </ResourceDictionary>
    </ContentView.Resources>
    <Grid HorizontalOptions="Center" VerticalOptions="Center" Padding="30">
        <Frame BackgroundColor="White" CornerRadius="24" Padding="0" HasShadow="True"
               WidthRequest="750" MaximumHeightRequest="800"
               HorizontalOptions="Center" VerticalOptions="Center">
            <Grid RowDefinitions="Auto,*" RowSpacing="0">
                <!-- Header -->
                <Grid Grid.Row="0" BackgroundColor="#5B4F45" Padding="20,15" ColumnDefinitions="*,Auto,Auto">
                    <Label Text="ðŸ“‹ To Prepare" FontAttributes="Bold" FontSize="18" TextColor="White" VerticalOptions="Center"/>
                    <Button Grid.Column="1" Text="âœ“ Accept All" FontSize="14" FontAttributes="Bold" BackgroundColor="#66BB6A" TextColor="White" 
                            CornerRadius="15" Padding="15,8" Margin="0,0,10,0"
                            Command="{Binding AcceptAllCommand}" HeightRequest="35"/>
                    <Button Grid.Column="2" Text="âœ•" FontSize="18" BackgroundColor="Transparent" TextColor="White" 
                            Command="{Binding CloseCommand}" WidthRequest="35" HeightRequest="35" Padding="0"/>
                </Grid>
                
                <!-- Orders List -->
                <CollectionView Grid.Row="1"
                                ItemsSource="{Binding PendingOrders}"
                                MaximumHeightRequest="700"
                                Margin="0">
                    <CollectionView.ItemsLayout>
                        <GridItemsLayout Orientation="Vertical" Span="2" HorizontalItemSpacing="8" VerticalItemSpacing="8" />
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BackgroundColor="#FAFAFA"
                                   HasShadow="False"
                                   Padding="20,15"
                                   Margin="4"
                                   BorderColor="#E0E0E0">
                                <Grid ColumnDefinitions="Auto,*,Auto" RowSpacing="10">
                                    <!-- Order Number -->
                                    <Frame Grid.Column="0"
                                           BackgroundColor="#5B4F45"
                                           CornerRadius="8"
                                           Padding="10,8"
                                           HasShadow="False"
                                           WidthRequest="50"
                                           HeightRequest="50"
                                           Margin="0,0,10,0">
                                        <Label VerticalOptions="Center"
                                               HorizontalOptions="Center"
                                               TextColor="White"
                                               FontSize="18"
                                               FontAttributes="Bold">
                                            <Label.Text>
                                                <MultiBinding Converter="{StaticResource IndexOfConverter}">
                                                    <Binding Path="BindingContext.PendingOrders" Source="{x:Reference Root}" />
                                                    <Binding />
                                                </MultiBinding>
                                            </Label.Text>
                                        </Label>
                                    </Frame>
                                    
                                    <!-- Order Info -->
                                    <VerticalStackLayout Grid.Column="1" Spacing="12">
                                        <Frame BackgroundColor="#E8D5C4"
                                               CornerRadius="8"
                                               Padding="12,8"
                                               HasShadow="False">
                                            <StackLayout Orientation="Horizontal" Spacing="8">
                                                <Label Text="{Binding ProductName}"
                                                       FontAttributes="Bold"
                                                       FontSize="16"
                                                       TextColor="#2B2B2B"
                                                       VerticalOptions="Center"/>
                                                <Frame BackgroundColor="#D4A574"
                                                       CornerRadius="6"
                                                       Padding="6,4"
                                                       HasShadow="False">
                                                    <Label Text="{Binding TotalQuantity, StringFormat='Total: {0}'}"
                                                           FontSize="14"
                                                           VerticalOptions="Center"
                                                           FontAttributes="Bold"
                                                           TextColor="White"/>
                                                </Frame>
                                            </StackLayout>
                                        </Frame>
                                        
                                        <VerticalStackLayout Spacing="10"
                                                             BindableLayout.ItemsSource="{Binding Items}">
                                            <BindableLayout.ItemTemplate>
                                                <DataTemplate>
                                                    <Frame BackgroundColor="White"
                                                           CornerRadius="10"
                                                           Padding="12"
                                                           HasShadow="False"
                                                           BorderColor="#E0E0E0">
                                                        <Grid RowDefinitions="Auto,Auto,Auto"
                                                              ColumnDefinitions="*,Auto"
                                                              RowSpacing="8">
                                                            <StackLayout Orientation="Horizontal"
                                                                         Spacing="8"
                                                                         Grid.Row="0"
                                                                         Grid.Column="0">
                                                                <Frame BackgroundColor="#D4A574"
                                                                       CornerRadius="6"
                                                                       Padding="6,4"
                                                                       HasShadow="False">
                                                                    <Label Text="{Binding Size}"
                                                                           FontAttributes="Bold"
                                                                           FontSize="14"
                                                                           TextColor="White"/>
                                                                </Frame>
                                                                <Label Text="{Binding Quantity, StringFormat='x{0}'}"
                                                                       FontSize="14"
                                                                       FontAttributes="Bold"
                                                                       TextColor="#5B4F45"
                                                                       VerticalOptions="Center"/>
                                                            </StackLayout>
                                                            <Button Grid.Row="0"
                                                                    Grid.Column="1"
                                                                    Text="âœ“"
                                                                    FontSize="16"
                                                                    FontAttributes="Bold"
                                                                    BackgroundColor="#66BB6A"
                                                                    TextColor="White"
                                                                    CornerRadius="20"
                                                                    WidthRequest="42"
                                                                    HeightRequest="42"
                                                                    Padding="0"
                                                                    Command="{Binding BindingContext.CompleteItemCommand, Source={x:Reference Root}}"
                                                                    CommandParameter="{Binding .}"/>

                                                            <VerticalStackLayout Grid.Row="1"
                                                                                 Grid.ColumnSpan="2"
                                                                                 Spacing="5"
                                                                                 IsVisible="{Binding Ingredients.Count, Converter={StaticResource IsPositiveConverter}}">
                                                                <Label Text="Ingredients:"
                                                                       FontAttributes="Bold"
                                                                       FontSize="13"
                                                                       TextColor="#5B4F45"/>
                                                                <Frame BackgroundColor="#FBF6F0"
                                                                       CornerRadius="6"
                                                                       Padding="10,6"
                                                                       HasShadow="False"
                                                                       BorderColor="#E0E0E0">
                                                                    <CollectionView ItemsSource="{Binding Ingredients}"
                                                                                    SelectionMode="None">
                                                                        <CollectionView.ItemTemplate>
                                                                            <DataTemplate>
                                                                                <Label FontSize="12"
                                                                                       TextColor="#444"
                                                                                       Margin="0,2,0,2">
                                                                                    <Label.Text>
                                                                                        <MultiBinding StringFormat="â€¢ {0}: {1} {2}">
                                                                                            <Binding Path="IngredientName"/>
                                                                                            <Binding Path="Amount"/>
                                                                                            <Binding Path="Unit"/>
                                                                                        </MultiBinding>
                                                                                    </Label.Text>
                                                                                </Label>
                                                                            </DataTemplate>
                                                                        </CollectionView.ItemTemplate>
                                                                    </CollectionView>
                                                                </Frame>
                                                            </VerticalStackLayout>

                                                            <VerticalStackLayout Grid.Row="2"
                                                                                 Grid.ColumnSpan="2"
                                                                                 Spacing="5"
                                                                                 IsVisible="{Binding Addons.Count, Converter={StaticResource IsPositiveConverter}}">
                                                                <Label Text="Add-ons:"
                                                                       FontAttributes="Bold"
                                                                       FontSize="13"
                                                                       TextColor="#5B4F45"/>
                                                                <Frame BackgroundColor="#FBF6F0"
                                                                       CornerRadius="6"
                                                                       Padding="10,6"
                                                                       HasShadow="False"
                                                                       BorderColor="#E0E0E0">
                                                                    <CollectionView ItemsSource="{Binding Addons}"
                                                                                    SelectionMode="None">
                                                                        <CollectionView.ItemTemplate>
                                                                            <DataTemplate>
                                                                                <Label FontSize="12"
                                                                                       TextColor="#666"
                                                                                       Margin="0,2,0,2">
                                                                                    <Label.Text>
                                                                                        <MultiBinding StringFormat="â€¢ {0} (x{1}): {2} {3} per serving">
                                                                                            <Binding Path="AddonName"/>
                                                                                            <Binding Path="Quantity"/>
                                                                                            <Binding Path="Amount"/>
                                                                                            <Binding Path="Unit"/>
                                                                                        </MultiBinding>
                                                                                    </Label.Text>
                                                                                </Label>
                                                                            </DataTemplate>
                                                                        </CollectionView.ItemTemplate>
                                                                    </CollectionView>
                                                                </Frame>
                                                            </VerticalStackLayout>
                                                        </Grid>
                                                    </Frame>
                                                </DataTemplate>
                                            </BindableLayout.ItemTemplate>
                                        </VerticalStackLayout>
                                    </VerticalStackLayout>
                                    
                                    <!-- Completed Button -->
                                    <Button Grid.Column="2"
                                            Text="âœ“"
                                            FontSize="18"
                                            FontAttributes="Bold"
                                            BackgroundColor="#66BB6A"
                                            TextColor="White"
                                            CornerRadius="25"
                                            WidthRequest="50"
                                            HeightRequest="50"
                                            Padding="0"
                                            Command="{Binding BindingContext.CompleteOrderCommand, Source={x:Reference Root}}"
                                            CommandParameter="{Binding .}"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Frame>
    </Grid>
</ContentView>


