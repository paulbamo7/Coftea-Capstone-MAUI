<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:Coftea_Capstone.ViewModel.Others"
             x:Class="Coftea_Capstone.Views.Controls.ProcessingQueuePopup"
             x:Name="Root"
             IsVisible="{Binding IsVisible}"
             BackgroundColor="#80000000">
    <ContentView.Resources>
        <ResourceDictionary>
            <converters:IsPositiveConverter x:Key="IsPositiveConverter"/>
        </ResourceDictionary>
    </ContentView.Resources>
    <Grid HorizontalOptions="Center" VerticalOptions="Center" Padding="30">
        <Frame BackgroundColor="White" CornerRadius="24" Padding="0" HasShadow="True"
               WidthRequest="750" MaximumHeightRequest="800"
               HorizontalOptions="Center" VerticalOptions="Center">
            <Grid RowDefinitions="Auto,*" RowSpacing="0">
                <!-- Header -->
                <Grid Grid.Row="0" BackgroundColor="#5B4F45" Padding="20,15" ColumnDefinitions="*,Auto,Auto">
                    <Label Text="ðŸ“‹ To Prepare" FontAttributes="Bold" FontSize="18" TextColor="White" VerticalOptions="Center"/>
                    <Button Grid.Column="1" Text="âœ“ Accept All" FontSize="14" FontAttributes="Bold" BackgroundColor="#66BB6A" TextColor="White" 
                            CornerRadius="15" Padding="15,8" Margin="0,0,10,0"
                            Command="{Binding AcceptAllCommand}" HeightRequest="35"/>
                    <Button Grid.Column="2" Text="âœ•" FontSize="18" BackgroundColor="Transparent" TextColor="White" 
                            Command="{Binding CloseCommand}" WidthRequest="35" HeightRequest="35" Padding="0"/>
                </Grid>
                
                <!-- Items List -->
                <CollectionView Grid.Row="1" ItemsSource="{Binding PendingItems}" MaximumHeightRequest="700" Margin="0">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BackgroundColor="#FAFAFA" HasShadow="False" Padding="20,15" Margin="0,0,0,8" BorderColor="#E0E0E0">
                                <Grid ColumnDefinitions="*,Auto" RowSpacing="10">
                                    <!-- Item Info -->
                                    <VerticalStackLayout Grid.Column="0" Spacing="8">
                                        <!-- Product Name and Size Header with distinct styling -->
                                        <Frame BackgroundColor="#E8D5C4" CornerRadius="8" Padding="12,8" HasShadow="False">
                                            <StackLayout Orientation="Horizontal" Spacing="8">
                                                <Label Text="{Binding ProductName}" FontAttributes="Bold" FontSize="16" TextColor="#2B2B2B" VerticalOptions="Center"/>
                                                <Frame BackgroundColor="#D4A574" CornerRadius="6" Padding="8,4" HasShadow="False">
                                                    <Label Text="{Binding Size}" FontSize="14" VerticalOptions="Center" FontAttributes="Bold" 
                                                           TextColor="White"/>
                                                </Frame>
                                                <Label Text="{Binding Quantity, StringFormat='x{0}'}" FontSize="14" TextColor="#5B4F45" FontAttributes="Bold" VerticalOptions="Center"/>
                                            </StackLayout>
                                        </Frame>
                                        
                                        <!-- Ingredients Section -->
                                        <VerticalStackLayout Spacing="5" Margin="0,5,0,0">
                                            <Label Text="Ingredients:" FontAttributes="Bold" FontSize="13" TextColor="#5B4F45" Margin="0,0,0,3"/>
                                            <Frame BackgroundColor="White" CornerRadius="6" Padding="12,8" HasShadow="False" BorderColor="#E0E0E0">
                                                <CollectionView ItemsSource="{Binding Ingredients}">
                                                    <CollectionView.ItemTemplate>
                                                        <DataTemplate>
                                                            <Label FontSize="12" TextColor="#444" Margin="0,2,0,2">
                                                                <Label.Text>
                                                                    <MultiBinding StringFormat="â€¢ {0}: {1} {2}">
                                                                        <Binding Path="IngredientName"/>
                                                                        <Binding Path="Amount"/>
                                                                        <Binding Path="Unit"/>
                                                                    </MultiBinding>
                                                                </Label.Text>
                                                            </Label>
                                                        </DataTemplate>
                                                    </CollectionView.ItemTemplate>
                                                </CollectionView>
                                            </Frame>
                                        </VerticalStackLayout>
                                        
                                        <!-- Add-ons Section -->
                                        <VerticalStackLayout Spacing="5" Margin="0,5,0,0">
                                            <Label Text="Add-ons:" FontAttributes="Bold" FontSize="13" TextColor="#5B4F45" Margin="0,0,0,3"/>
                                            <Frame BackgroundColor="White" CornerRadius="6" Padding="12,8" HasShadow="False" BorderColor="#E0E0E0">
                                                <CollectionView ItemsSource="{Binding Addons}">
                                                    <CollectionView.ItemTemplate>
                                                        <DataTemplate>
                                                            <Label FontSize="12" TextColor="#666" Margin="0,2,0,2">
                                                                <Label.Text>
                                                                    <MultiBinding StringFormat="â€¢ {0} (x{1}): {2} {3} per serving">
                                                                        <Binding Path="AddonName"/>
                                                                        <Binding Path="Quantity"/>
                                                                        <Binding Path="Amount"/>
                                                                        <Binding Path="Unit"/>
                                                                    </MultiBinding>
                                                                </Label.Text>
                                                            </Label>
                                                        </DataTemplate>
                                                    </CollectionView.ItemTemplate>
                                                </CollectionView>
                                            </Frame>
                                        </VerticalStackLayout>
                                    </VerticalStackLayout>
                                    
                                    <!-- Completed Button -->
                                    <Button Grid.Column="1" Text="âœ“" FontSize="18" FontAttributes="Bold"
                                            BackgroundColor="#66BB6A" TextColor="White"
                                            CornerRadius="25" WidthRequest="50" HeightRequest="50" Padding="0"
                                            Command="{Binding BindingContext.CompleteItemCommand, Source={x:Reference Root}}"
                                            CommandParameter="{Binding .}"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Frame>
    </Grid>
</ContentView>


