<ContentView
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="Coftea_Capstone.Views.Controls.AddItemToPOS"
    xmlns:views="clr-namespace:Coftea_Capstone.Views.Pages"
    xmlns:otherViews="clr-namespace:Coftea_Capstone.Views.Controls"
    BackgroundColor="#80000000"
    IsVisible="{Binding IsAddItemToPOSVisible}"
    InputTransparent="False">

    <Grid ColumnDefinitions="200, *" RowDefinitions="*" InputTransparent="False">

        <VerticalStackLayout Grid.Column="1" Padding="40,60,40,60" Spacing="25">
            <FlexLayout Direction="Row" Wrap="NoWrap" AlignItems="Start" JustifyContent="SpaceBetween" Padding="0,0,0,0">

                <!-- Left Panel: Product Details -->
                <Frame CornerRadius="30" BackgroundColor="#F8E8D7" HasShadow="True" HeightRequest="600" WidthRequest="500" Padding="30" MaximumWidthRequest="520" FlexLayout.Grow="1" Margin="0,0,20,0">
                    <VerticalStackLayout Spacing="20">

                        <!-- Header -->
                        <Label Text="Product Details" FontAttributes="Bold" FontSize="30" TextColor="Black" FontFamily="OpenSansSemibold" HorizontalOptions="Start"/>

                        <!-- Product Name -->
                        <Label Text="Product Name" FontSize="18" TextColor="Black" FontFamily="OpenSansRegular"/>
                        <Frame CornerRadius="12" Padding="8" BackgroundColor="Transparent" BorderColor="#B89C83" HasShadow="False">
                            <Entry Placeholder="Enter Product Name"
                                   PlaceholderColor="#4B3832"
                                   Text="{Binding ProductName}"
                                   BackgroundColor="Transparent"
                                   FontSize="16"
                                   TextColor="Black"
                                   FontFamily="OpenSansRegular"/>
                        </Frame>

                        <!-- Product Image (optional) -->
                        <Frame CornerRadius="20" BackgroundColor="#F8E8D7" HeightRequest="180" Padding="8">
                            <Grid>
                                <Grid RowDefinitions="*,Auto">
                                    <Image Source="{Binding SelectedImageSource}" Aspect="AspectFit"/>
                                    <Label Grid.Row="1" Text="No image selected (optional)" FontSize="12" TextColor="Black" HorizontalOptions="Center" IsVisible="False">
                                        <Label.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding SelectedImageSource}" Value="{x:Null}">
                                                <Setter Property="IsVisible" Value="True" />
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                </Grid>
                                <Button BackgroundColor="Transparent" Command="{Binding PickImageCommand}"/>
                            </Grid>
                        </Frame>

                        <!-- Category & Subcategory -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="20">
                            <VerticalStackLayout Spacing="8" Grid.Column="0">
                                <Label Text="Category" FontSize="18" TextColor="Black" FontFamily="OpenSansRegular"/>
                                <Picker Title="Select Category"
                                        ItemsSource="{Binding Categories}"
                                        SelectedItem="{Binding SelectedCategory}"
                                        FontSize="16"
                                        TextColor="Black"
                                        BackgroundColor="Transparent"
                                        FontFamily="OpenSansRegular"
                                        TitleColor="#4B3832"/>
                            </VerticalStackLayout>

                            <VerticalStackLayout Spacing="8" Grid.Column="1" IsVisible="{Binding IsFruitSodaSubcategoryVisible}">
                                <Label Text="Subcategory" FontSize="18" TextColor="Black" FontFamily="OpenSansRegular"/>
                                <Picker Title="Select Subcategory"
                                        ItemsSource="{Binding FruitSodaSubcategories}"
                                        SelectedItem="{Binding SelectedSubcategory}"
                                        FontSize="16"
                                        TextColor="Black"
                                        BackgroundColor="Transparent"
                                        FontFamily="OpenSansRegular"
                                        TitleColor="#4B3832"/>
                            </VerticalStackLayout>

                            <VerticalStackLayout Spacing="8" Grid.Column="1" IsVisible="{Binding IsCoffeeSubcategoryVisible}">
                                <Label Text="Subcategory" FontSize="18" TextColor="Black" FontFamily="OpenSansRegular"/>
                                <Picker Title="Select Subcategory"
                                        ItemsSource="{Binding CoffeeSubcategories}"
                                        SelectedItem="{Binding SelectedSubcategory}"
                                        FontSize="16"
                                        TextColor="Black"
                                        BackgroundColor="Transparent"
                                        FontFamily="OpenSansRegular"
                                        TitleColor="#4B3832"/>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Color Code - COMMENTED OUT -->
                        <!--
                        <Label Text="Color Code" FontSize="18" TextColor="Black" FontFamily="OpenSansRegular"/>
                        <Frame CornerRadius="12" Padding="8" BackgroundColor="Transparent" BorderColor="#B89C83" HasShadow="False">
                            <Entry Placeholder="Enter Color Code"
                                   PlaceholderColor="#4B3832"
                                   Keyboard="Text"
                                   Text="{Binding ProductColorCode}"
                                   BackgroundColor="Transparent"
                                   FontSize="16"
                                   TextColor="Black"
                                   FontFamily="OpenSansRegular"/>
                        </Frame>
                        -->
                    </VerticalStackLayout>
                </Frame>

                <!-- Right Panel: Pricing & Description -->
                <Frame CornerRadius="30" BackgroundColor="#F8E8D7" HasShadow="True" HeightRequest="600" WidthRequest="500" Padding="30" MaximumWidthRequest="520" FlexLayout.Grow="1" Margin="20,0,0,0">
                    <VerticalStackLayout Spacing="20">

                        <!-- Header -->
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Text="Product Size" FontAttributes="Bold" FontSize="30" Grid.Column="0" VerticalOptions="Center" TextColor="Black" FontFamily="OpenSansSemibold"/>
                            <ImageButton Source="close.png" WidthRequest="30" HeightRequest="30" Grid.Column="1" VerticalOptions="Center" Command="{Binding CloseAddItemToPOSCommand}"/>
                        </Grid>

                        <!-- Pricing Grid -->
                        <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10" HorizontalOptions="Fill">
                            <!-- Small Price - Only visible for Coffee -->
                            <VerticalStackLayout Spacing="8" Grid.Column="0" IsVisible="{Binding IsSmallPriceVisible}">
                                <Label Text="Small Price" FontSize="16" TextColor="Black" FontFamily="OpenSansRegular" HorizontalOptions="Center"/>
                                <Frame CornerRadius="12" Padding="8" BackgroundColor="Transparent" BorderColor="#B89C83" HasShadow="False">
                                    <Entry Placeholder="Small Price"
                                           Keyboard="Numeric"
                                           Text="{Binding SmallPrice}"
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                           FontSize="14"
                                           FontFamily="OpenSans-Regular"
                                           HorizontalOptions="Fill"/>
                                </Frame>
                            </VerticalStackLayout>

                            <!-- Medium Price - Always visible -->
                            <VerticalStackLayout Spacing="8" Grid.Column="1" IsVisible="{Binding IsMediumPriceVisible}">
                                <Label Text="Medium Price" FontSize="16" TextColor="Black" FontFamily="OpenSansRegular" HorizontalOptions="Center"/>
                                <Frame CornerRadius="12" Padding="8" BackgroundColor="Transparent" BorderColor="#B89C83" HasShadow="False">
                                    <Entry Placeholder="Medium Price"
                                           Keyboard="Numeric"
                                           Text="{Binding MediumPrice}"
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                           FontSize="14"
                                           FontFamily="OpenSans-Regular"
                                           HorizontalOptions="Fill">
                                        <Entry.Triggers>
                                            <DataTrigger TargetType="Entry" Binding="{Binding IsSmallPriceVisible}" Value="False">
                                                <Setter Property="Text" Value="" />
                                            </DataTrigger>
                                        </Entry.Triggers>
                                    </Entry>
                                </Frame>
                            </VerticalStackLayout>

                            <!-- Large Price - Always visible -->
                            <VerticalStackLayout Spacing="8" Grid.Column="2" IsVisible="{Binding IsLargePriceVisible}">
                                <Label Text="Large Price" FontSize="16" TextColor="Black" FontFamily="OpenSansRegular" HorizontalOptions="Center"/>
                                <Frame CornerRadius="12" Padding="8" BackgroundColor="Transparent" BorderColor="#B89C83" HasShadow="False">
                                    <Entry Placeholder="Large Price"
                                           Keyboard="Numeric"
                                           Text="{Binding LargePrice}"
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                           FontSize="14"
                                           FontFamily="OpenSans-Regular"
                                           HorizontalOptions="Fill">
                                        <Entry.Triggers>
                                            <DataTrigger TargetType="Entry" Binding="{Binding IsSmallPriceVisible}" Value="False">
                                                <Setter Property="Text" Value="" />
                                            </DataTrigger>
                                        </Entry.Triggers>
                                    </Entry>
                                </Frame>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Description -->
                        <Label Text="Description (Optional)" FontSize="18" TextColor="Black" FontFamily="OpenSansRegular"/>
                        <Frame CornerRadius="12" Padding="8" BackgroundColor="Transparent" BorderColor="#B89C83" HasShadow="False">
                            <Editor Placeholder="Enter product description..."
                                    Text="{Binding ProductDescription}"
                                    BackgroundColor="Transparent"
                                    TextColor="Black"
                                    FontSize="16"
                                    HeightRequest="160"
                                    FontFamily="OpenSans-Regular"/>
                        </Frame>

                        <!-- Action Buttons -->
                        <HorizontalStackLayout HorizontalOptions="End" Spacing="20">
                            <Button Text="Close" WidthRequest="130" HeightRequest="50"
                                    BackgroundColor="#D3D3D3"
                                    TextColor="Black"
                                    CornerRadius="25"
                                    Command="{Binding CloseAddItemToPOSCommand}"/>
                            <Button Text="Next" WidthRequest="160" HeightRequest="50"
                                    BackgroundColor="#E6DE9D"
                                    TextColor="Black"
                                    CornerRadius="25"
                                    Command="{Binding OpenConnectPOSToInventoryCommand}"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>

            </FlexLayout>
        </VerticalStackLayout>

        <!-- Subcomponents -->
        <otherViews:ConnectPOSItemToInventory BindingContext="{Binding ConnectPOSToInventoryVM}" Grid.Column="2"/>
        <otherViews:InputIngredientsAmountUsed BindingContext="{Binding ConnectPOSToInventoryVM}" Grid.Column="2"/>
        <otherViews:PreviewPOSItem BindingContext="{Binding ConnectPOSToInventoryVM}" Grid.Column="2"/>

        <!-- History popup for selected items -->
        <otherViews:HistoryPopup BindingContext="{Binding Source={x:Static Application.Current}, Path=HistoryPopup}" Grid.ColumnSpan="2"/>

        <!-- Success popup -->
        <otherViews:SuccessCardPopup BindingContext="{Binding Source={x:Static Application.Current}, Path=SuccessCardPopup}" Grid.ColumnSpan="2" />

    </Grid>
</ContentView>