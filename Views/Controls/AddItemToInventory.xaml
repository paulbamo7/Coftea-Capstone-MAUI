<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="Coftea_Capstone.Views.Controls.AddItemToInventory"
    xmlns:converters="clr-namespace:Coftea_Capstone.ViewModel.Others"
    BackgroundColor="#80000000"
    IsVisible="{Binding IsAddItemToInventoryVisible}"
    InputTransparent="False">

    <ContentView.Resources>
        <ResourceDictionary>
            <converters:InvertBoolConverter x:Key="InvertBoolConverter" />
        </ResourceDictionary>
    </ContentView.Resources>

    <Grid HorizontalOptions="Center" VerticalOptions="Center">
        <Frame
            BackgroundColor="#F8E8D7"
            CornerRadius="20"
            HasShadow="True"
            Padding="0"
            WidthRequest="1050"
            HeightRequest="700">

            <Grid ColumnDefinitions="500,2,*" RowDefinitions="*" BackgroundColor="#F8E8D7">

                <!-- LEFT PANEL -->
                <VerticalStackLayout Padding="27" BackgroundColor="#F8E8D7">
                    <Label Text="Add Item To Inventory"
                           FontAttributes="Bold"
                           FontSize="30"
                           Margin="0,0,0,20"
                           TextColor="Black" />

                    <!-- STOCK NAME -->
                    <Label Text="STOCK NAME" FontAttributes="Bold" FontSize="16" TextColor="Black" Padding="0,20,0,0"/>
                    <Entry Placeholder="Enter stock name"
                           Text="{Binding ItemName}"
                           Margin="0,0,0,10"
                           FontSize="14"
                           TextColor="Black"
                           PlaceholderColor="Black"/>

                    <!-- STOCK IMAGE (updated with upload prompt) -->
                    <Label Text="STOCK IMAGE"
                           FontAttributes="Bold"
                           FontSize="16"
                           TextColor="Black"
                           Margin="0,20,0,5" />

                    <Frame CornerRadius="12"
                           BackgroundColor="White"
                           HasShadow="False"
                           Padding="20"
                           WidthRequest="400"
                           HeightRequest="200">

                        <Grid>
                            <!-- Preview area (visible when an image is selected) -->
                            <Grid IsVisible="{Binding SelectedImageSource}">
                                <Image Source="{Binding SelectedImageSource}"
                                       Aspect="AspectFill"
                                       WidthRequest="360"
                                       HeightRequest="160" />

                                <ImageButton Source="close.png"
                                             WidthRequest="28"
                                             HeightRequest="28"
                                             BackgroundColor="#80000000"
                                             CornerRadius="14"
                                             HorizontalOptions="End"
                                             VerticalOptions="Start"
                                             Margin="6"
                                             Command="{Binding RemoveImageCommand}" />
                            </Grid>

                            <!-- Upload Placeholder (visible when no image selected) -->
                            <VerticalStackLayout HorizontalOptions="Center"
                                               VerticalOptions="Center"
                                               Spacing="10"
                                               IsVisible="{Binding SelectedImageSource, Converter={StaticResource InvertBoolConverter}}">
                                <Image Source="uploadicon.png"
                                       WidthRequest="40"
                                       HeightRequest="40"
                                       Opacity="0.85" />
                                <Label Text="Choose a file or drag and drop it here"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="#6B5B3E"
                                       HorizontalTextAlignment="Center" />
                                <Label Text="JPEG, PNG (max 3MB)"
                                       FontSize="12"
                                       TextColor="#9A8A6A"
                                       HorizontalTextAlignment="Center" />
                                <Button Text="Browse File"
                                        Command="{Binding PickImageCommand}"
                                        WidthRequest="120"
                                        HeightRequest="36"
                                        CornerRadius="18"
                                        BackgroundColor="#E0E0E0"
                                        TextColor="#333333"
                                        FontAttributes="Bold" />
                            </VerticalStackLayout>

                            <!-- Invisible overlay so whole area is clickable -->
                            <Button BackgroundColor="Transparent"
                                    Command="{Binding PickImageCommand}"
                                    IsVisible="{Binding SelectedImageSource, Converter={StaticResource InvertBoolConverter}}"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="Fill" />
                        </Grid>
                    </Frame>

                    <!-- PRODUCT CATEGORY -->
                    <Label Text="PRODUCT CATEGORY" FontAttributes="Bold" FontSize="16" TextColor="Black" Margin="0,20,0,5" />
                    <Picker Title="Select Category"
                            ItemsSource="{Binding Categories}"
                            SelectedItem="{Binding ItemCategory}"
                            FontSize="14"
                            TextColor="Black"
                            HeightRequest="40"/>
                </VerticalStackLayout>

                <!-- VERTICAL SEPARATOR -->
                <BoxView Grid.Column="1"
                         WidthRequest="2"
                         Color="#C9A87C"
                         VerticalOptions="Fill"
                         HorizontalOptions="Center"/>

                <!-- RIGHT PANEL -->
                <ScrollView Grid.Column="2" Padding="30" BackgroundColor="#F8E8D7">
                    <VerticalStackLayout Spacing="15" BackgroundColor="#F8E8D7" Padding="20,0,0,0">

                        <!-- HEADER -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Text="Measurement Details" FontSize="27" FontAttributes="Bold" Grid.Column="0" TextColor="Black" />
                            <ImageButton Source="close.png"
                                         WidthRequest="25"
                                         HeightRequest="25"
                                         Grid.Column="1"
                                         VerticalOptions="Center"
                                         Command="{Binding CloseAddItemToInventoryCommand}"/>
                        </Grid>

                        <!-- STOCK QUANTITY & UOM -->
                        <HorizontalStackLayout Spacing="20">
                            <VerticalStackLayout>
                                <Label Text="STOCK QUANTITY" FontAttributes="Bold" FontSize="16" TextColor="Black" Padding="0,20,0,0"/>
                                <Entry Placeholder="Enter quantity"
                                       Text="{Binding UoMQuantity}"
                                       Keyboard="Numeric"
                                       TextColor="Black"
                                       FontSize="14"
                                       WidthRequest="200"
                                       HeightRequest="40"/>
                            </VerticalStackLayout>

                            <VerticalStackLayout>
                                <Label Text="UNIT OF MEASUREMENT" FontAttributes="Bold" FontSize="16" TextColor="Black"  Padding="0,20,0,0"/>
                                <Picker Title="Select UoM"
                                        ItemsSource="{Binding UoMOptions}"
                                        SelectedItem="{Binding SelectedUoM}"
                                        FontSize="14"
                                        TextColor="Black"
                                        WidthRequest="200"
                                        HeightRequest="40"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <!-- MINIMUM STOCK SECTION -->
                        <Label Text="MINIMUM STOCK LEVEL" FontAttributes="Bold" FontSize="27" TextColor="Black" Margin="0,40,0,0"/>
                        <HorizontalStackLayout Spacing="20">
                            <VerticalStackLayout>
                                <Label Text="MINIMUM QUANTITY" FontAttributes="Bold" FontSize="18" TextColor="Black" />
                                <Entry Placeholder="Enter minimum quantity"
                                       Text="{Binding MinimumQuantity}"
                                       Keyboard="Numeric"
                                       TextColor="Black"
                                       FontSize="14"
                                       WidthRequest="200"
                                       HeightRequest="40"/>
                            </VerticalStackLayout>

                            <VerticalStackLayout>
                                <Label Text="MINIMUM UoM" FontAttributes="Bold" FontSize="18" TextColor="Black"/>
                                <HorizontalStackLayout Spacing="10">
                                    <Entry Placeholder="Quantity"
                                           Text="{Binding MinimumUoMQuantity}"
                                           Keyboard="Numeric"
                                           TextColor="Black"
                                           FontSize="14"
                                           WidthRequest="100"/>
                                    <Picker Title="Select UoM"
                                            ItemsSource="{Binding UoMOptions}"
                                            SelectedItem="{Binding SelectedMinimumUoM}"
                                            FontSize="14"
                                            TextColor="Black"
                                            WidthRequest="150"/>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <!-- DESCRIPTION -->
                        <Label Text="DESCRIPTION (OPTIONAL)" FontAttributes="Bold" FontSize="16" TextColor="Black" Margin="0,20,0,5"/>
                        <Editor Placeholder="Enter item description..."
                                Text="{Binding ItemDescription}"
                                HeightRequest="120"
                                BackgroundColor="#FFFFFF"
                                TextColor="Black"/>

                        <!-- ADD BUTTON -->
                        <Button Text="Add Item"
                                WidthRequest="150"
                                BackgroundColor="#FFCC00"
                                TextColor="Black"
                                Command="{Binding AddItemCommand}"
                                HorizontalOptions="End"
                                Margin="0,20,0,0"
                                FontSize="16"
                                FontAttributes="Bold"
                                CornerRadius="25"/>
                    </VerticalStackLayout>
                </ScrollView>
            </Grid>
        </Frame>
    </Grid>
</ContentView>