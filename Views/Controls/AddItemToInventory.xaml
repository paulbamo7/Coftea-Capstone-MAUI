<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="Coftea_Capstone.Views.Controls.AddItemToInventory"
    xmlns:converters="clr-namespace:Coftea_Capstone.ViewModel.Others"
    BackgroundColor="#80000000"
    IsVisible="{Binding IsAddItemToInventoryVisible}"
    InputTransparent="False">

    <ContentView.Resources>
        <ResourceDictionary>
            <converters:InvertBoolConverter x:Key="InvertBoolConverter" />
            <converters:NullToBoolConverter x:Key="NullToBoolConverter" />
            <converters:NullToInvertedBoolConverter x:Key="NullToInvertedBoolConverter" />
        </ResourceDictionary>
    </ContentView.Resources>

    <Grid HorizontalOptions="Center" VerticalOptions="Center">
        <Frame
            BackgroundColor="#F8E8D7"
            CornerRadius="20"
            HasShadow="True"
            Padding="0"
            WidthRequest="1050"
            HeightRequest="700">

            <Grid ColumnDefinitions="500,2,*" RowDefinitions="*" BackgroundColor="#F8E8D7">

                <!-- LEFT PANEL -->
                <VerticalStackLayout Padding="27" BackgroundColor="#F8E8D7">
                    <Label Text="Add Item To Inventory"
                           FontAttributes="Bold"
                           FontSize="30"
                           Margin="0,0,0,10"
                           TextColor="Black" />

                    <!-- STOCK NAME -->
                    <Label Text="STOCK NAME" FontAttributes="Bold" FontSize="20" TextColor="Black" Padding="0,20,0,0"/>
                    <Entry Placeholder="Enter stock name"
                           Text="{Binding ItemName}"
                           Margin="0,0,0,10"
                           FontSize="18"
                           TextColor="Black"
                           PlaceholderColor="Black"/>

                    <!-- STOCK IMAGE (updated with upload prompt) -->
                    <Label Text="STOCK IMAGE"
                           FontAttributes="Bold"
                           FontSize="20"
                           TextColor="Black"
                           Margin="0,20,0,5" />

                    <Frame CornerRadius="12"
                           BackgroundColor="White"
                           HasShadow="False"
                           Padding="20"
                           WidthRequest="400"
                           HeightRequest="200">

                        <Grid>
                            <!-- Preview area (visible when an image is selected) -->
                            <Grid IsVisible="{Binding SelectedImageSource, Converter={StaticResource NullToBoolConverter}}">
                                <Image Source="{Binding SelectedImageSource}"
                                       Aspect="AspectFill"
                                       WidthRequest="360"
                                       HeightRequest="160" />

                                <ImageButton Source="close.png"
                                             WidthRequest="28"
                                             HeightRequest="28"
                                             BackgroundColor="#80000000"
                                             CornerRadius="14"
                                             HorizontalOptions="End"
                                             VerticalOptions="Start"
                                             Margin="6"
                                             Command="{Binding RemoveImageCommand}" />
                            </Grid>

                            <!-- Upload Placeholder (visible when no image selected) -->
                            <VerticalStackLayout HorizontalOptions="Center"
                                               VerticalOptions="Center"
                                               Spacing="10"
                                               IsVisible="{Binding SelectedImageSource, Converter={StaticResource NullToInvertedBoolConverter}}">
                                <Image Source="uploadicon.png"
                                       WidthRequest="40"
                                       HeightRequest="40"
                                       Opacity="0.85" />
                                <Label Text="Choose a file or drag and drop it here"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="#6B5B3E"
                                       HorizontalTextAlignment="Center" />
                                <Label Text="JPEG, PNG (max 3MB)"
                                       FontSize="12"
                                       TextColor="#9A8A6A"
                                       HorizontalTextAlignment="Center" />
                                <Button Text="Browse File"
                                        Command="{Binding PickImageCommand}"
                                        WidthRequest="120"
                                        HeightRequest="36"
                                        CornerRadius="18"
                                        FontSize="14"
                                        Padding="0"
                                        BackgroundColor="#E0E0E0"
                                        TextColor="#333333"
                                        FontAttributes="Bold" />
                            </VerticalStackLayout>

                            <!-- Invisible overlay so whole area is clickable -->
                            <Button BackgroundColor="Transparent"
                                    Command="{Binding PickImageCommand}"
                                    IsVisible="{Binding SelectedImageSource, Converter={StaticResource NullToInvertedBoolConverter}}"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="Fill" />
                        </Grid>
                    </Frame>

                    <!-- PRODUCT CATEGORY -->
                    <Label Text="PRODUCT CATEGORY" FontAttributes="Bold" FontSize="20" TextColor="Black" Margin="0,20,0,5" />
                    <Picker Title="Select Category"
                            ItemsSource="{Binding Categories}"
                            SelectedItem="{Binding ItemCategory}"
                            FontSize="18"
                            TextColor="Black"
                            HeightRequest="40"/>
                </VerticalStackLayout>

                <!-- VERTICAL SEPARATOR -->
                <BoxView Grid.Column="1"
                         WidthRequest="2"
                         Color="#C9A87C"
                         VerticalOptions="Fill"
                         HorizontalOptions="Center"/>

                <!-- RIGHT PANEL -->
                <ScrollView Grid.Column="2" Padding="30" BackgroundColor="#F8E8D7">
                    <VerticalStackLayout Spacing="15" BackgroundColor="#F8E8D7" Padding="15,0,0,0">

                        <!-- HEADER -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Text="Measurement Details" FontSize="30" FontAttributes="Bold" Grid.Column="0" TextColor="Black" />
                            <ImageButton Source="close.png"
                                         WidthRequest="25"
                                         HeightRequest="25"
                                         Grid.Column="1"
                                         VerticalOptions="Center"
                                         Command="{Binding CloseAddItemToInventoryCommand}"/>
                        </Grid>

                        <!-- STOCK QUANTITY & UOM -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="20">
                            <Label Grid.Column="0" Text="STOCK QUANTITY" FontSize="16" FontAttributes="Bold" TextColor="#8B4513"/>
                            <Label Grid.Column="1" Text="UNIT OF MEASUREMENT" FontSize="16" FontAttributes="Bold" TextColor="#8B4513"/>
                        </Grid>
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="20" Margin="0,5,0,0">
                            <Entry Grid.Column="0"
                                   Placeholder="Enter stock quantity"
                                   Text="{Binding UoMQuantity}"
                                   Keyboard="Numeric" 
                                   TextColor="Black" FontSize="16"/>
                            <Picker Grid.Column="1"
                                    Title="Select UoM"
                                    ItemsSource="{Binding UoMOptions}"
                                    SelectedItem="{Binding SelectedUoM}"
                                    FontSize="16" TextColor="Black"/>
                        </Grid>

                        <!-- MINIMUM STOCK SECTION -->
                        <VerticalStackLayout Margin="0,20,0,0">
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="20">
                                <Label Grid.Column="0" Text="MINIMUM QUANTITY LEVEL" FontSize="16" FontAttributes="Bold" TextColor="#8B4513"/>
                                <Label Grid.Column="1" Text="MEASUREMENT" FontSize="16" FontAttributes="Bold" TextColor="#8B4513"/>
                            </Grid>
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="20" Margin="0,5,0,0">
                                <Entry Grid.Column="0"
                                       Placeholder="Enter minimum quantity"
                                       Text="{Binding MinimumQuantity}"
                                       Keyboard="Numeric" 
                                       TextColor="Black" FontSize="16"/>
                                <Picker Grid.Column="1"
                                        Title="Select UoM"
                                        ItemsSource="{Binding UoMOptions}"
                                        SelectedItem="{Binding SelectedMinimumUoM}" 
                                        FontSize="16" TextColor="Black"/>
                            </Grid>
                        </VerticalStackLayout>

                        <!-- MAXIMUM STOCK SECTION -->
                        <VerticalStackLayout Margin="0,20,0,0">
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="20">
                                <Label Grid.Column="0" Text="MAXIMUM QUANTITY LEVEL" FontSize="16" FontAttributes="Bold" TextColor="#8B4513"/>
                                <Label Grid.Column="1" Text="MEASUREMENT" FontSize="16" FontAttributes="Bold" TextColor="#8B4513"/>
                            </Grid>
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="20" Margin="0,5,0,0">
                                <Entry Grid.Column="0"
                                       Placeholder="Enter maximum quantity (optional)"
                                       Text="{Binding MaximumQuantity}"
                                       Keyboard="Numeric" 
                                       TextColor="Black" FontSize="16"/>
                                <Picker Grid.Column="1"
                                        Title="Select UoM"
                                        ItemsSource="{Binding UoMOptions}"
                                        SelectedItem="{Binding SelectedMaximumUoM}" 
                                        FontSize="16" TextColor="Black"/>
                            </Grid>
                        </VerticalStackLayout>

                        <!-- DESCRIPTION -->
                        <Label Text="DESCRIPTION (OPTIONAL)" FontSize="18" FontAttributes="Bold" TextColor="#8B4513" Margin="0,20,0,10"/>
                        <Frame BackgroundColor="White" CornerRadius="10" Padding="15" HasShadow="False">
                            <Editor Placeholder="Enter item description..." 
                                    HeightRequest="120" 
                                    Text="{Binding ItemDescription}" 
                                    BackgroundColor="Transparent"
                                    TextColor="Black"
                                    FontSize="16"/>
                        </Frame>

                        <!-- BUTTONS -->
                        <HorizontalStackLayout HorizontalOptions="End" Spacing="20" Margin="0,20,0,0">
                            <Button Text="Save"
                                    WidthRequest="150"
                                    BackgroundColor="#4CAF50"
                                    TextColor="White"
                                    Command="{Binding SaveItemCommand}"
                                    CornerRadius="25"
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    IsVisible="{Binding IsEditMode}"/>

                            <Button Text="Add Item"
                                    WidthRequest="150"
                                    BackgroundColor="#FFCC00"
                                    TextColor="Black"
                                    Command="{Binding AddItemCommand}"
                                    CornerRadius="25"
                                    FontSize="16"
                                    FontAttributes="Bold"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </ScrollView>
            </Grid>
        </Frame>
    </Grid>
</ContentView>