<?xml version="1.0" encoding="utf-8" ?>
<ContentView 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:Coftea_Capstone.ViewModel.Others"
    x:Class="Coftea_Capstone.Views.Controls.PaymentPopup"
    x:Name="PaymentPopupView"
    BackgroundColor="#80000000"
    IsVisible="{Binding IsPaymentVisible, FallbackValue=False, TargetNullValue=False}"
    InputTransparent="False">

    <ContentView.Resources>
        <ResourceDictionary>
            <converters:NullToBoolConverter x:Key="NullToBoolConverter"/>
            <converters:InvertBoolConverter x:Key="InvertBoolConverter"/>
            <converters:ChangeColorConverter x:Key="ChangeColorConverter"/>
            <converters:StatusColorConverter x:Key="StatusColorConverter"/>
            <converters:IsPositiveConverter x:Key="IsPositiveConverter"/>
        </ResourceDictionary>
    </ContentView.Resources>

    <Grid VerticalOptions="Fill" HorizontalOptions="Fill" InputTransparent="False">
        <Grid.GestureRecognizers>
            <TapGestureRecognizer Command="{Binding ClosePaymentCommand}" />
        </Grid.GestureRecognizers>
        
        <!-- Cancel Confirmation Overlay -->
        <Frame IsVisible="{Binding IsCancelConfirmationVisible}"
               BackgroundColor="#E0000000"
               VerticalOptions="Fill"
               HorizontalOptions="Fill"
               Padding="0"
               HasShadow="False"
               InputTransparent="False"
               ZIndex="10000">
            <Grid VerticalOptions="Center" HorizontalOptions="Center" InputTransparent="False">
                <Frame BackgroundColor="#F8E8D7"
                       CornerRadius="20"
                       Padding="30"
                       WidthRequest="400"
                       HasShadow="True"
                       InputTransparent="False">
                    <VerticalStackLayout Spacing="20">
                        <Label Text="Pause Payment"
                               FontSize="20" FontFamily="MontserratBlack" FontAttributes="Bold"
                               TextColor="#5B4F45"
                               HorizontalOptions="Center"
                               IsVisible="{Binding IsProcessingPayment}" />
                        <Label Text="Cancel Payment"
                               FontSize="20" FontFamily="MontserratBlack" FontAttributes="Bold"
                               TextColor="#5B4F45"
                               HorizontalOptions="Center"
                               IsVisible="{Binding IsProcessingPayment, Converter={StaticResource InvertBoolConverter}}" />
                        <Label Text="Payment is currently being processed. Do you want to pause it?"
                               FontSize="14" FontFamily="MontserratBlack"
                               TextColor="#5B4F45"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               LineBreakMode="WordWrap"
                               IsVisible="{Binding IsProcessingPayment}" />
                        <Label Text="Are you sure you want to cancel this payment? All entered amounts will be reset."
                               FontSize="14" FontFamily="MontserratBlack"
                               TextColor="#5B4F45"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               LineBreakMode="WordWrap"
                               IsVisible="{Binding IsProcessingPayment, Converter={StaticResource InvertBoolConverter}}" />
                        <HorizontalStackLayout Spacing="15" HorizontalOptions="Center">
                            <Button Text="Yes"
                                    BackgroundColor="#4CAF50"
                                    TextColor="White"
                                    FontSize="14" FontFamily="MontserratBlack" FontAttributes="Bold"
                                    CornerRadius="15"
                                    WidthRequest="100"
                                    HeightRequest="40"
                                    Command="{Binding ConfirmCancelCommand}" />
                            <Button Text="No"
                                    BackgroundColor="#BDAEA2"
                                    TextColor="White"
                                    FontSize="14" FontFamily="MontserratBlack" FontAttributes="Bold"
                                    CornerRadius="15"
                                    WidthRequest="100"
                                    HeightRequest="40"
                                    Command="{Binding DismissCancelConfirmationCommand}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>
            </Grid>
        </Frame>
        
        <!-- Payment Frame -->
        <Frame VerticalOptions="Center"
               HorizontalOptions="Center"
               Padding="0"
               BackgroundColor="#F8E8D7"
               CornerRadius="20"
               WidthRequest="750"
               HeightRequest="550"
               HasShadow="True"
               InputTransparent="False">

            <Grid RowDefinitions="Auto, *, Auto">
                <!-- Header -->
                <Grid Grid.Row="0" BackgroundColor="#5B4F45" Padding="20,15">
                    <Grid ColumnDefinitions="*, Auto">
                        <Label Grid.Column="0" 
                               Text="Cash Payment" 
                               FontSize="24" FontFamily="MontserratBlack" 
                               FontAttributes="Bold"
                               VerticalOptions="Center"
                               TextColor="White" />
                        <Button Grid.Column="1"
                                Text="×"
                                FontSize="24" FontFamily="MontserratBlack"
                                FontAttributes="Bold"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                WidthRequest="40"
                                HeightRequest="40"
                                Padding="0"
                                VerticalOptions="Center"
                                Command="{Binding ClosePaymentCommand}" />
                    </Grid>
                </Grid>

                <!-- Payment Content -->
                <Grid Grid.Row="1" Padding="30" ColumnDefinitions="1.2*, *" ColumnSpacing="20">
                    <!-- Left Side: Payment Details -->
                    <ScrollView Grid.Column="0" 
                                VerticalScrollBarVisibility="Never" 
                                HorizontalScrollBarVisibility="Never">
                        <Grid RowDefinitions="Auto, Auto, *">
                            <!-- Payment Method Selector -->
                            <Grid Grid.Row="0" ColumnDefinitions="Auto, Auto" Margin="0,0,0,20">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="Payment Method:" 
                                       FontSize="16" FontFamily="MontserratBlack"
                                       FontAttributes="Bold"
                                       TextColor="Black" />
                                <HorizontalStackLayout Spacing="20">
                                    <RadioButton x:Name="CashRadio"
                                                 Content="Cash"
                                                 GroupName="PaymentMethod"
                                                 IsChecked="True"
                                                 TextColor="#5B4F45"
                                                 VerticalOptions="Center"
                                                 CheckedChanged="OnPaymentMethodChanged" />
                                    <RadioButton x:Name="GCashRadio"
                                                 Content="GCash"
                                                 GroupName="PaymentMethod"
                                                 TextColor="#5B4F45"
                                                 VerticalOptions="Center"
                                                 CheckedChanged="OnPaymentMethodChanged" />
                                    <RadioButton x:Name="BankRadio"
                                                 Content="Bank"
                                                 GroupName="PaymentMethod"
                                                 TextColor="#5B4F45"
                                                 VerticalOptions="Center"
                                                 CheckedChanged="OnPaymentMethodChanged" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- CASH SECTION (kept as-is) -->
                        <Grid Grid.Row="1" IsVisible="{Binding Source={x:Reference CashRadio}, Path=IsChecked}">
                            <Grid RowDefinitions="Auto, Auto, Auto, Auto, Auto, Auto">
                                <!-- Total Amount -->
                                <Grid Grid.Row="0" Margin="0,0,0,20">
                                    <Label Text="Total Amount:" 
                                           FontSize="18" FontFamily="MontserratBlack" 
                                           FontAttributes="Bold"
                                           TextColor="Black" />
                                    <Label Text="{Binding TotalAmount, StringFormat='₱{0:F2}'}" 
                                           FontSize="24" FontFamily="MontserratBlack" 
                                           FontAttributes="Bold"
                                           TextColor="#5B4F45"
                                           HorizontalOptions="End" />
                                </Grid>

                                <!-- Amount Paid Input -->
                                <Grid Grid.Row="1" Margin="0,0,0,15">
                                    <Label Text="Amount Paid:" 
                                           FontSize="16" FontFamily="MontserratBlack" 
                                           TextColor="Black" />
                                    <Entry x:Name="AmountPaidEntry"
                                           Text="{Binding AmountPaid, StringFormat='{0:F2}'}"
                                           FontSize="18" FontFamily="MontserratBlack"
                                           FontAttributes="Bold"
                                           TextColor="#5B4F45"
                                           HorizontalOptions="End"
                                           WidthRequest="150"
                                           Placeholder="0.00"
                                           Keyboard="Numeric"
                                           TextChanged="OnAmountPaidChanged" />
                                </Grid>

                                <!-- Change Display -->
                                <Grid Grid.Row="2" Margin="0,0,0,20">
                                    <Label Text="Change:" 
                                           FontSize="16" FontFamily="MontserratBlack" 
                                           TextColor="Black" />
                                    <Label Text="{Binding Change, StringFormat='₱{0:F2}'}" 
                                           FontSize="18" FontFamily="MontserratBlack" 
                                           FontAttributes="Bold"
                                           TextColor="{Binding Change, Converter={StaticResource ChangeColorConverter}}"
                                           HorizontalOptions="End" />
                                </Grid>

                                <!-- Payment Status -->
                                <Grid Grid.Row="3" Margin="0,0,0,20" ColumnDefinitions="*,Auto">
                                    <Label Grid.Column="0" Text="Status:" 
                                           FontSize="16" FontFamily="MontserratBlack" 
                                           TextColor="Black" 
                                           VerticalOptions="Center" />
                                    <VerticalStackLayout Grid.Column="1" Spacing="5" IsVisible="{Binding IsPaymentPaused}">
                                        <Label Text="{Binding PaymentStatus}" 
                                               FontSize="16" FontFamily="MontserratBlack" 
                                               FontAttributes="Bold"
                                               TextColor="{Binding PaymentStatus, Converter={StaticResource StatusColorConverter}}"
                                               VerticalOptions="Center" />
                                        <HorizontalStackLayout Spacing="10" HorizontalOptions="End">
                                            <Button Text="Resume"
                                                    BackgroundColor="#4CAF50"
                                                    TextColor="White"
                                                    FontSize="12" FontFamily="MontserratBlack" FontAttributes="Bold"
                                                    CornerRadius="10"
                                                    Padding="15,5"
                                                    HeightRequest="30"
                                                    Command="{Binding ResumePaymentCommand}" />
                                            <Button Text="Cancel"
                                                    BackgroundColor="#C62828"
                                                    TextColor="White"
                                                    FontSize="12" FontFamily="MontserratBlack" FontAttributes="Bold"
                                                    CornerRadius="10"
                                                    Padding="15,5"
                                                    HeightRequest="30"
                                                    Command="{Binding FullyCancelPaymentCommand}" />
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>
                                    <Label Grid.Column="1" Text="{Binding PaymentStatus}" 
                                           FontSize="16" FontFamily="MontserratBlack" 
                                           FontAttributes="Bold"
                                           TextColor="{Binding PaymentStatus, Converter={StaticResource StatusColorConverter}}"
                                           VerticalOptions="Center"
                                           IsVisible="{Binding IsPaymentPaused, Converter={StaticResource InvertBoolConverter}}" />
                                </Grid>

                                <!-- Quick Amount Buttons -->
                                <VerticalStackLayout Grid.Row="4" Margin="0,0,0,20" Spacing="8">
                                    <Label Text="Quick Amounts (Add):" 
                                           FontSize="14" FontFamily="MontserratBlack" 
                                           TextColor="Gray"
                                           LineBreakMode="NoWrap"
                                           HorizontalOptions="Start"
                                           VerticalOptions="Start" />
                                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Start">
                                        <Button Text="+₱50" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#E8D5C4"
                                                TextColor="Black"
                                                CornerRadius="15"
                                                Padding="0"
                                                WidthRequest="55"
                                                HeightRequest="30"
                                                Command="{Binding AddToAmountPaidCommand}"
                                                CommandParameter="50" />
                                        <Button Text="+₱100" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#E8D5C4"
                                                TextColor="Black"
                                                CornerRadius="15"
                                                Padding="0"
                                                WidthRequest="60"
                                                HeightRequest="30"
                                                Command="{Binding AddToAmountPaidCommand}"
                                                CommandParameter="100" />
                                        <Button Text="+₱200" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#E8D5C4"
                                                TextColor="Black"
                                                CornerRadius="15"
                                                Padding="0"
                                                WidthRequest="60"
                                                HeightRequest="30"
                                                Command="{Binding AddToAmountPaidCommand}"
                                                CommandParameter="200" />
                                        <Button Text="+₱500" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#E8D5C4"
                                                TextColor="Black"
                                                CornerRadius="15"
                                                Padding="0"
                                                WidthRequest="60"
                                                HeightRequest="30"
                                                Command="{Binding AddToAmountPaidCommand}"
                                                CommandParameter="500" />
                                        <Button Text="+₱1000" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#E8D5C4"
                                                TextColor="Black"
                                                CornerRadius="15"
                                                Padding="0"
                                                WidthRequest="65"
                                                HeightRequest="30"
                                                Command="{Binding AddToAmountPaidCommand}"
                                                CommandParameter="1000" />
                                    </HorizontalStackLayout>
                                    
                                    <Label Text="Quick Amounts (Subtract):" 
                                           FontSize="14" FontFamily="MontserratBlack" 
                                           TextColor="Gray"
                                           LineBreakMode="NoWrap"
                                           HorizontalOptions="Start"
                                           VerticalOptions="Start"
                                           Margin="0,8,0,0" />
                                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Start">
                                        <Button Text="-₱50" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#D4A574"
                                                TextColor="White"
                                                CornerRadius="15"
                                                Padding="0"
                                                WidthRequest="55"
                                                HeightRequest="30"
                                                Command="{Binding SubtractFromAmountPaidCommand}"
                                                CommandParameter="50" />
                                        <Button Text="-₱100" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#D4A574"
                                                TextColor="White"
                                                CornerRadius="15"
                                                Padding="0"
                                                WidthRequest="60"
                                                HeightRequest="30"
                                                Command="{Binding SubtractFromAmountPaidCommand}"
                                                CommandParameter="100" />
                                        <Button Text="-₱200" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#D4A574"
                                                TextColor="White"
                                                CornerRadius="15"
                                                Padding="0"
                                                WidthRequest="60"
                                                HeightRequest="30"
                                                Command="{Binding SubtractFromAmountPaidCommand}"
                                                CommandParameter="200" />
                                        <Button Text="-₱500" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#D4A574"
                                                TextColor="White"
                                                CornerRadius="15"
                                                Padding="0"
                                                WidthRequest="60"
                                                HeightRequest="30"
                                                Command="{Binding SubtractFromAmountPaidCommand}"
                                                CommandParameter="500" />
                                        <Button Text="-₱1000" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#D4A574"
                                                TextColor="White"
                                                CornerRadius="15"
                                                Padding="0"
                                                WidthRequest="65"
                                                HeightRequest="30"
                                                Command="{Binding SubtractFromAmountPaidCommand}"
                                                CommandParameter="1000" />
                                    </HorizontalStackLayout>
                                    
                                    <!-- Clear and Cancel Buttons -->
                                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Start" Margin="0,8,0,0">
                                        <Button Text="Clear" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#BDAEA2"
                                                TextColor="White"
                                                CornerRadius="15"
                                                Padding="15,0"
                                                HeightRequest="30"
                                                Command="{Binding ClearAmountPaidCommand}" />
                                        <Button Text="Cancel Payment" 
                                                FontSize="12" FontFamily="MontserratBlack"
                                                BackgroundColor="#C62828"
                                                TextColor="White"
                                                CornerRadius="15"
                                                Padding="15,0"
                                                HeightRequest="30"
                                                Command="{Binding CancelPaymentCommand}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>

                                <!-- Confirm Button -->
                                <Button Grid.Row="5"
                                        Text="Confirm Payment" 
                                        FontSize="16" FontFamily="MontserratBlack" 
                                        FontAttributes="Bold"
                                        BackgroundColor="#4CAF50" 
                                        TextColor="White" 
                                        CornerRadius="20"
                                        HeightRequest="50"
                                        Command="{Binding ConfirmPaymentCommand}"
                                        IsEnabled="{Binding CanConfirmPayment}"
                                        Margin="0,10,0,0" />
                            </Grid>
                        </Grid>

                        <!-- GCASH SECTION (realistic simulation) -->
                        <Grid Grid.Row="1" IsVisible="{Binding Source={x:Reference GCashRadio}, Path=IsChecked}">
                            <Grid RowDefinitions="Auto, Auto, Auto, Auto">
                                <!-- Total Amount -->
                                <Grid Grid.Row="0" Margin="0,0,0,20">
                                    <Label Text="Total Amount:" 
                                           FontSize="18" FontFamily="MontserratBlack" 
                                           FontAttributes="Bold"
                                           TextColor="Black" />
                                    <Label Text="{Binding TotalAmount, StringFormat='₱{0:F2}'}" 
                                           FontSize="24" FontFamily="MontserratBlack" 
                                           FontAttributes="Bold"
                                           TextColor="#5B4F45"
                                           HorizontalOptions="End" />
                                </Grid>

                                <!-- Payment Status -->
                                <VerticalStackLayout Grid.Row="1" Spacing="4" Margin="0,0,0,15">
                                    <Label Text="Payment Status:" 
                                           FontSize="16" FontFamily="MontserratBlack" 
                                           TextColor="Black" />
                                    <Label Text="{Binding PaymentStatus}" 
                                           FontSize="16" FontFamily="MontserratBlack" 
                                           FontAttributes="Bold"
                                           TextColor="{Binding PaymentStatus, Converter={StaticResource StatusColorConverter}}" />
                                </VerticalStackLayout>

                                <!-- GCash Payment Steps -->
                                <Frame Grid.Row="2" Padding="15" BackgroundColor="#F0F9FF" CornerRadius="10" HasShadow="False" Margin="0,0,0,15">
                                    <VerticalStackLayout Spacing="8">
                                        <Label Text="Payment Steps:" FontSize="14" FontFamily="MontserratBlack" FontAttributes="Bold" TextColor="#0EA5E9" />
                                        <Label Text="1. Customer pays via GCash app" FontSize="12" FontFamily="MontserratBlack" TextColor="#374151" />
                                        <Label Text="2. Verify payment in GCash app" FontSize="12" FontFamily="MontserratBlack" TextColor="#374151" />
                                        <Label Text="3. Confirm payment received" FontSize="12" FontFamily="MontserratBlack" TextColor="#374151" />
                                    </VerticalStackLayout>
                                </Frame>

                                <!-- Mark as Paid Button -->
                                <Button Grid.Row="3"
                                        Text="Mark as Paid"
                                        FontSize="16" FontFamily="MontserratBlack"
                                        FontAttributes="Bold"
                                        BackgroundColor="#0EA5E9" 
                                        TextColor="White"
                                        CornerRadius="20"
                                        HeightRequest="50"
                                        Command="{Binding ConfirmPaymentCommand}" />
                            </Grid>
                        </Grid>

                        <!-- BANK SECTION (realistic simulation) -->
                        <Grid Grid.Row="1" IsVisible="{Binding Source={x:Reference BankRadio}, Path=IsChecked}">
                            <Grid RowDefinitions="Auto, Auto, Auto, Auto, Auto">
                                <!-- Total Amount -->
                                <Grid Grid.Row="0" Margin="0,0,0,20">
                                    <Label Text="Total Amount:" 
                                           FontSize="18" FontFamily="MontserratBlack" 
                                           FontAttributes="Bold"
                                           TextColor="Black" />
                                    <Label Text="{Binding TotalAmount, StringFormat='₱{0:F2}'}" 
                                           FontSize="24" FontFamily="MontserratBlack" 
                                           FontAttributes="Bold"
                                           TextColor="#5B4F45"
                                           HorizontalOptions="End" />
                                </Grid>

                                <!-- Bank Transfer Details -->
                                <Frame Grid.Row="1" Padding="20" BackgroundColor="#FFFFFF" CornerRadius="12" HasShadow="True" Margin="0,0,0,15">
                                    <VerticalStackLayout Spacing="12">
                                        <Label Text="Bank Transfer Payment" FontSize="16" FontFamily="MontserratBlack" FontAttributes="Bold" TextColor="#8B5CF6" HorizontalOptions="Center" />
                                        
                                        <!-- Bank Account Details -->
                                        <Frame BackgroundColor="#F8F9FA" CornerRadius="8" Padding="15" HasShadow="False">
                                            <VerticalStackLayout Spacing="8">
                                                <Label Text="Transfer to:" FontSize="14" FontFamily="MontserratBlack" FontAttributes="Bold" TextColor="#374151" />
                                                <Label Text="Account Name: Coftea Coffee Shop" FontSize="12" FontFamily="MontserratBlack" TextColor="#6B7280" />
                                                <Label Text="Account Number: 1234-5678-9012-3456" FontSize="12" FontFamily="MontserratBlack" TextColor="#6B7280" />
                                                <Label Text="Bank: BDO (Banco de Oro)" FontSize="12" FontFamily="MontserratBlack" TextColor="#6B7280" />
                                                <Label Text="{Binding TotalAmount, StringFormat='Amount: ₱{0:F2}'}" FontSize="14" FontFamily="MontserratBlack" FontAttributes="Bold" TextColor="#8B5CF6" />
                                            </VerticalStackLayout>
                                        </Frame>
                                        
                                        <Label Text="Use your bank's mobile app or online banking" FontSize="12" FontFamily="MontserratBlack" TextColor="#666666" HorizontalOptions="Center" />
                                    </VerticalStackLayout>
                                </Frame>

                                <!-- Payment Status -->
                                <VerticalStackLayout Grid.Row="2" Spacing="4" Margin="0,0,0,15">
                                    <Label Text="Payment Status:" 
                                           FontSize="16" FontFamily="MontserratBlack" 
                                           TextColor="Black" />
                                    <Label Text="{Binding PaymentStatus}" 
                                           FontSize="16" FontFamily="MontserratBlack" 
                                           FontAttributes="Bold"
                                           TextColor="{Binding PaymentStatus, Converter={StaticResource StatusColorConverter}}" />
                                </VerticalStackLayout>

                                <!-- Bank Transfer Steps -->
                                <Frame Grid.Row="3" Padding="15" BackgroundColor="#F3F4F6" CornerRadius="10" HasShadow="False" Margin="0,0,0,15">
                                    <VerticalStackLayout Spacing="8">
                                        <Label Text="Transfer Steps:" FontSize="14" FontFamily="MontserratBlack" FontAttributes="Bold" TextColor="#8B5CF6" />
                                        <Label Text="1. Open your bank's mobile app" FontSize="12" FontFamily="MontserratBlack" TextColor="#374151" />
                                        <Label Text="2. Go to 'Transfer' or 'Send Money'" FontSize="12" FontFamily="MontserratBlack" TextColor="#374151" />
                                        <Label Text="3. Enter account details and amount" FontSize="12" FontFamily="MontserratBlack" TextColor="#374151" />
                                        <Label Text="4. Add reference: 'Coftea Order'" FontSize="12" FontFamily="MontserratBlack" TextColor="#374151" />
                                        <Label Text="5. Confirm and complete transfer" FontSize="12" FontFamily="MontserratBlack" TextColor="#374151" />
                                    </VerticalStackLayout>
                                </Frame>

                                <!-- Mark as Paid Button -->
                                <Button Grid.Row="4"
                                        Text="Mark as Paid"
                                        FontSize="16" FontFamily="MontserratBlack"
                                        FontAttributes="Bold"
                                        BackgroundColor="#8B5CF6" 
                                        TextColor="White"
                                        CornerRadius="20"
                                        HeightRequest="50"
                                        Command="{Binding ConfirmPaymentCommand}" />
                            </Grid>
                        </Grid>
                    </Grid>
                    </ScrollView>

                    <!-- Right Side: Order Summary -->
                    <ScrollView Grid.Column="1" 
                                VerticalScrollBarVisibility="Never" 
                                HorizontalScrollBarVisibility="Never">
                        <Frame Padding="15" BackgroundColor="#FFFFFF" CornerRadius="12" HasShadow="True">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="Order Summary" FontSize="18" FontFamily="MontserratBlack" FontAttributes="Bold" TextColor="#5B4F45" HorizontalOptions="Center" />
                                
                                <!-- Cart Items List -->
                                <CollectionView ItemsSource="{Binding CartItems}" HeightRequest="300">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Border StrokeThickness="0" Padding="10,8" Margin="0,3" BackgroundColor="#F8F8F8" StrokeShape="RoundRectangle 6">
                                                <Grid RowDefinitions="Auto, Auto, Auto, Auto">
                                                    <!-- Product Name -->
                                                    <Label Grid.Row="0" Text="{Binding ProductName}" 
                                                           FontSize="14" FontFamily="MontserratBlack" FontAttributes="Bold" 
                                                           TextColor="Black" Margin="0,0,0,4" />
                                                    
                                                    <!-- Size Breakdown -->
                                                    <StackLayout Grid.Row="1" Spacing="3" Margin="0,0,0,3">
                                                        <Label Text="{Binding SmallDisplayCompact}" 
                                                               FontSize="11" FontFamily="MontserratBlack" TextColor="#666666" 
                                                               IsVisible="{Binding HasSmall}" />
                                                        <Label Text="{Binding MediumDisplayCompact}" 
                                                               FontSize="11" FontFamily="MontserratBlack" TextColor="#666666" 
                                                               IsVisible="{Binding HasMedium}" />
                                                        <Label Text="{Binding LargeDisplayCompact}" 
                                                               FontSize="11" FontFamily="MontserratBlack" TextColor="#666666" 
                                                               IsVisible="{Binding HasLarge}" />
                                                    </StackLayout>
                                                    
                                                    <!-- Add-ons -->
                                                    <Label Grid.Row="2" Text="{Binding AddOnsDisplay}" 
                                                           FontSize="10" FontFamily="MontserratBlack" TextColor="#8B5CF6" 
                                                           IsVisible="{Binding AddOnsDisplay, Converter={StaticResource NullToBoolConverter}}"
                                                           Margin="0,0,0,3"
                                                           LineBreakMode="TailTruncation" />
                                                    
                                                    <!-- Item Total -->
                                                    <Grid Grid.Row="3" ColumnDefinitions="*, Auto">
                                                        <Label Grid.Column="0" Text="Subtotal:" 
                                                               FontSize="11" FontFamily="MontserratBlack" FontAttributes="Bold" 
                                                               TextColor="#5B4F45" />
                                                        <Label Grid.Column="1" Text="{Binding TotalPrice, StringFormat='₱{0:F2}'}" 
                                                               FontSize="12" FontFamily="MontserratBlack" FontAttributes="Bold" 
                                                               TextColor="#5B4F45" />
                                                    </Grid>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                                
                                <!-- Total Amount -->
                                <Frame BackgroundColor="#F8E8D7" CornerRadius="8" Padding="10" HasShadow="False" Margin="0,8,0,0">
                                    <Grid ColumnDefinitions="*, Auto">
                                        <Label Grid.Column="0" Text="Total:" FontSize="16" FontFamily="MontserratBlack" FontAttributes="Bold" TextColor="#5B4F45" />
                                        <Label Grid.Column="1" Text="{Binding TotalAmount, StringFormat='₱{0:F2}'}" 
                                               FontSize="18" FontFamily="MontserratBlack" FontAttributes="Bold" TextColor="#5B4F45" />
                                    </Grid>
                                </Frame>
                            </VerticalStackLayout>
                        </Frame>
                    </ScrollView>
                </Grid>
            </Grid>
        </Frame>
    </Grid>
</ContentView>
