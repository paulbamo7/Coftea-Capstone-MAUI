<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:Coftea_Capstone.Views.Controls"
             x:Class="Coftea_Capstone.Views.Controls.PreviewPOSItem"
             x:Name="Root"
             BackgroundColor="#80000000"
             IsVisible="{Binding IsPreviewVisible}">

    <Grid HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
        <!-- Addons Selection Popup (overlay above preview frame) -->
        <controls:AddonsSelectionPopup BindingContext="{Binding AddonsPopup}" ZIndex="1000" />
        <Frame BackgroundColor="#F8E8D7"
               CornerRadius="20"
               Padding="20"
               HorizontalOptions="Center"
               VerticalOptions="Center"
               WidthRequest="500"
               HeightRequest="600">
            <ScrollView>
                <VerticalStackLayout Spacing="15">
                    <!-- Header -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Label Text="Preview Product" FontAttributes="Bold" FontSize="24" Grid.Column="0"/>
                        <ImageButton Source="close.png"
                                 WidthRequest="25" HeightRequest="25"
                                 Grid.Column="1"
                                 Command="{Binding ClosePreviewCommand}"/>
                    </Grid>

                    <!-- Product Image (frame removed as requested) -->
                    <Image Source="{Binding SelectedImageSource}" Aspect="AspectFit" HeightRequest="150"/>


                    <!-- Product Info -->
                    <Label Text="{Binding ProductName}" FontAttributes="Bold" FontSize="22"/>
                    <Label Text="Add-ons Used" FontAttributes="Bold"/>
                    <!-- Show only selected addons with editable inputs below the Add-ons text -->
                    <CollectionView ItemsSource="{Binding SelectedAddons}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,Auto,Auto" Padding="8" Margin="0,4">
                                    <HorizontalStackLayout>
                                        <Label Grid.Column="0" Text="{Binding itemName}"/>
                                        <Entry Grid.Column="1" WidthRequest="90" Keyboard="Numeric" Placeholder="Price"
                                               Text="{Binding AddonPrice}"/>
                                        <Picker Grid.Column="2" WidthRequest="80" ItemsSource="{Binding AllowedUnits}"
                                                SelectedItem="{Binding AddonUnit}"/>
                                    </HorizontalStackLayout>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    <HorizontalStackLayout Spacing="12">

                        <Label Text="Category:" FontSize="18" FontAttributes="Bold"/>
                        <Label Text="{Binding SelectedCategory}" FontSize="18" FontAttributes="Bold"/>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="20">
                        <Label Text="Prices:" FontAttributes="Bold"/>
                        <VerticalStackLayout>
                            <Label Text="Small Price" FontAttributes="Bold"/>
                            <Label Text="{Binding SmallPrice, StringFormat='₱{0:F2}'}" FontSize="18"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout>
                            <Label Text="Medium Price" FontAttributes="Bold"/>
                            <Label Text="{Binding MediumPrice, StringFormat='₱{0:F2}'}" FontSize="18"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout>
                            <Label Text="Large Price" FontAttributes="Bold"/>
                            <Label Text="{Binding LargePrice, StringFormat='₱{0:F2}'}" FontSize="18"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <Label Text="Description" FontAttributes="Bold"/>
                    <ScrollView HeightRequest="80">
                        <Label Text="{Binding ProductDescription}" FontSize="16"/>
                    </ScrollView>
                    <!-- Inline Addons section removed; selection will be via popup -->

                    <!-- Buttons -->
                    <HorizontalStackLayout HorizontalOptions="End" Spacing="20">
                        <Button Text="Close" BackgroundColor="#D3D3D3" TextColor="Black"
                            Command="{Binding ClosePreviewCommand}"/>
                        <Button Text="Add Addons" BackgroundColor="#D3D3D3" TextColor="Black"
                            Command="{Binding OpenAddonPopupCommand}"/>
                        <Button Text="Confirm" BackgroundColor="#E6DE9D" TextColor="Black"
                            Command="{Binding ConfirmPreviewCommand}"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </ScrollView>
        </Frame>
    </Grid>
</ContentView>
