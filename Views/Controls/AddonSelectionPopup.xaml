<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Coftea_Capstone.Views.Controls.AddonSelectionPopup"
             BackgroundColor="#80000000"
             IsVisible="{Binding IsAddonPopupVisible, FallbackValue=False, TargetNullValue=False}"
             HorizontalOptions="FillAndExpand"
             VerticalOptions="FillAndExpand"
             InputTransparent="False">

    <Frame BackgroundColor="#FFFFFF" CornerRadius="16" Padding="16" WidthRequest="450" HeightRequest="520"
           HorizontalOptions="Center" VerticalOptions="Center"
           InputTransparent="False">
        <VerticalStackLayout Spacing="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Label Text="Select Addons" FontAttributes="Bold" FontSize="20"/>
                <ImageButton Grid.Column="1" Source="close.png" WidthRequest="24" HeightRequest="24"
                             Command="{Binding CloseAddonPopupCommand}"/>
            </Grid>

            <CollectionView ItemsSource="{Binding AvailableAddons}" HeightRequest="360">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="Auto,*,Auto,Auto" Padding="8,4">
                            <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected}" VerticalOptions="Center"/>
                            <Label Grid.Column="1" Text="{Binding itemName}" VerticalOptions="Center"/>
                            <Entry Grid.Column="2" WidthRequest="90" Keyboard="Numeric" Placeholder="Price"
                                   Text="{Binding AddonPrice}" VerticalOptions="Center"/>
                            <Picker Grid.Column="3" WidthRequest="80" ItemsSource="{Binding AllowedUnits}"
                                    SelectedItem="{Binding AddonUnit}" VerticalOptions="Center"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <HorizontalStackLayout HorizontalOptions="End" Spacing="12">
                <Button Text="Cancel" BackgroundColor="#D3D3D3" TextColor="Black"
                        Command="{Binding CloseAddonPopupCommand}"/>
                <Button Text="Add Selected" BackgroundColor="#E6DE9D" TextColor="Black"
                        Command="{Binding ConfirmAddonSelectionCommand}"/>
            </HorizontalStackLayout>
        </VerticalStackLayout>
    </Frame>
</ContentView>
