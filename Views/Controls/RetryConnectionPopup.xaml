<?xml version="1.0" encoding="utf-8" ?>
<ContentView 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="Coftea_Capstone.Views.Controls.RetryConnectionPopup"
    x:Name="RetryConnectionPopupView"
    BackgroundColor="#80000000"
    VerticalOptions="FillAndExpand"
    HorizontalOptions="FillAndExpand"
    IsVisible="{Binding IsRetryPopupVisible}"
    InputTransparent="False">

    <AbsoluteLayout HorizontalOptions="Fill" 
                    VerticalOptions="Fill"
                    InputTransparent="False">
        
        <!-- Click-blocking overlay -->
        <BoxView BackgroundColor="#80000000" 
                 HorizontalOptions="Fill" 
                 VerticalOptions="Fill"
                 AbsoluteLayout.LayoutBounds="0,0,1,1"
                 AbsoluteLayout.LayoutFlags="All">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding CloseRetryPopupCommand}" />
            </BoxView.GestureRecognizers>
        </BoxView>
        
        <!-- Popup Frame - Centered -->
        <Frame Padding="0"
               BackgroundColor="#F8E8D7"
               CornerRadius="20"
               WidthRequest="400"
               HeightRequest="280"
               HasShadow="True"
               InputTransparent="False"
               AbsoluteLayout.LayoutBounds="0.5,0.5,-1,-1"
               AbsoluteLayout.LayoutFlags="PositionProportional">

            <VerticalStackLayout Spacing="20" HorizontalOptions="Fill" Padding="30">
                <!-- Error Icon -->
                <!--<Image Source="warning.png" 
                       HeightRequest="50" 
                       WidthRequest="50" 
                       HorizontalOptions="Center" />-->
                
                <!-- Title -->
                <Label Text="Connection Error" 
                       FontSize="20" FontFamily="MontserratBlack" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" 
                       TextColor="#8B4513" />
                
                <!-- Error Message -->
                <Label Text="{Binding ErrorMessage}" 
                       FontSize="14" FontFamily="MontserratBlack" 
                       HorizontalOptions="Center" 
                       HorizontalTextAlignment="Center"
                       TextColor="#654321"
                       LineBreakMode="WordWrap" />
                
                <!-- Loading Indicator -->
                <ActivityIndicator IsRunning="{Binding IsRetrying}" 
                                   IsVisible="{Binding IsRetrying}"
                                   Color="#8B4513"
                                   HorizontalOptions="Center" />
                
                <!-- Buttons -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,10,0,0">
                    <Button Grid.Column="0"
                            Text="CANCEL"
                            BackgroundColor="#D2691E"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="40"
                            FontFamily="MontserratBlack"
                            FontSize="14"
                            Command="{Binding CancelRetryCommand}"
                            IsEnabled="{Binding IsRetrying, Converter={StaticResource InvertBoolConverter}}" />
                    
                    <Button Grid.Column="1"
                            Text="RETRY"
                            BackgroundColor="#8B4513"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="40"
                            FontFamily="MontserratBlack"
                            FontSize="14"
                            Command="{Binding RetryConnectionCommand}"
                            IsEnabled="{Binding IsRetrying, Converter={StaticResource InvertBoolConverter}}" />
                </Grid>
            </VerticalStackLayout>
        </Frame>
    </AbsoluteLayout>
</ContentView>
