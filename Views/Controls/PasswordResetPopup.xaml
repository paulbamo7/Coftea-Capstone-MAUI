<?xml version="1.0" encoding="utf-8" ?>
<ContentView 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="Coftea_Capstone.Views.Controls.PasswordResetPopup"
    x:Name="PasswordResetPopupView"
    BackgroundColor="#80000000"
    IsVisible="{Binding IsPasswordResetPopupVisible}"
    InputTransparent="False">

    <Grid VerticalOptions="Fill" HorizontalOptions="Fill" InputTransparent="False">
        <Grid.GestureRecognizers>
            <TapGestureRecognizer Command="{Binding ClosePasswordResetPopupCommand}" />
        </Grid.GestureRecognizers>
        
        <!-- Popup Frame -->
        <Frame VerticalOptions="Center"
               HorizontalOptions="Center"
               Padding="30"
               BackgroundColor="#F8E8D7"
               CornerRadius="20"
               WidthRequest="450"
               HeightRequest="500"
               HasShadow="True"
               InputTransparent="False">

            <VerticalStackLayout Spacing="20" HorizontalOptions="Fill">
                <!-- Title -->
                <Label Text="Reset Password" 
                       FontSize="24" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" 
                       TextColor="#8B4513" />
                
                <!-- Email Display -->
                <Frame BackgroundColor="#E8D5C4" 
                       CornerRadius="10" 
                       Padding="15">
                    <VerticalStackLayout>
                        <Label Text="Email:" 
                               FontAttributes="Bold" 
                               FontSize="14" 
                               TextColor="#654321" />
                        <Label Text="{Binding Email}" 
                               FontSize="16" 
                               TextColor="#8B4513" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Verification Code -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Verification Code:" 
                           FontAttributes="Bold" 
                           FontSize="16" 
                           TextColor="#8B4513" />
                    <Entry Text="{Binding ResetToken}" 
                           Placeholder="Enter 6-digit code"
                           Keyboard="Numeric"
                           MaxLength="6"
                           BackgroundColor="White"
                           HeightRequest="45"
                           FontSize="16" />
                </VerticalStackLayout>

                <!-- New Password -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="New Password:" 
                           FontAttributes="Bold" 
                           FontSize="16" 
                           TextColor="#8B4513" />
                    <Grid>
                        <Entry x:Name="NewPasswordEntry" Text="{Binding NewPassword}"
                               Placeholder="Enter new password"
                               IsPassword="True"
                               BackgroundColor="White"
                               HeightRequest="45"
                               FontSize="16" />
                        <Button Text="Show"
                                Padding="10,0"
                                BackgroundColor="Transparent"
                                HorizontalOptions="End"
                                VerticalOptions="Center"
                                Clicked="OnToggleNewPasswordVisibility" />
                    </Grid>
                </VerticalStackLayout>

                <!-- Confirm Password -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Confirm Password:" 
                           FontAttributes="Bold" 
                           FontSize="16" 
                           TextColor="#8B4513" />
                    <Grid>
                        <Entry x:Name="ConfirmPasswordEntry" Text="{Binding ConfirmPassword}"
                               Placeholder="Confirm new password"
                               IsPassword="True"
                               BackgroundColor="White"
                               HeightRequest="45"
                               FontSize="16" />
                        <Button Text="Show"
                                Padding="10,0"
                                BackgroundColor="Transparent"
                                HorizontalOptions="End"
                                VerticalOptions="Center"
                                Clicked="OnToggleConfirmPasswordVisibility" />
                    </Grid>
                </VerticalStackLayout>

                <!-- Error Message -->
                <Label Text="{Binding ErrorMessage}" 
                       FontSize="14" 
                       TextColor="Red"
                       HorizontalTextAlignment="Center"
                       IsVisible="{Binding ErrorMessage, Converter={StaticResource NullToBoolConverter}}"
                       LineBreakMode="WordWrap" />

                <!-- Loading Indicator -->
                <ActivityIndicator IsRunning="{Binding IsResetting}" 
                                   IsVisible="{Binding IsResetting}"
                                   Color="#8B4513"
                                   HorizontalOptions="Center" />

                <!-- Buttons -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,10,0,0">
                    <Button Grid.Column="0"
                            Text="Request New Code"
                            BackgroundColor="#D2691E"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="45"
                            Command="{Binding RequestNewResetCommand}"
                            IsEnabled="{Binding IsResetting, Converter={StaticResource InvertBoolConverter}}" />
                    
                    <Button Grid.Column="1"
                            Text="Reset Password"
                            BackgroundColor="#8B4513"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="45"
                            Command="{Binding ResetPasswordCommand}"
                            IsEnabled="{Binding IsResetting, Converter={StaticResource InvertBoolConverter}}" />
                </Grid>

                <!-- Close Button -->
                <Button Text="Cancel"
                        BackgroundColor="#A52A2A"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        Command="{Binding ClosePasswordResetPopupCommand}" />
            </VerticalStackLayout>
        </Frame>
    </Grid>
</ContentView>
