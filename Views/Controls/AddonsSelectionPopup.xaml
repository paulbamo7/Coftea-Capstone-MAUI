<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Coftea_Capstone.Views.Controls.AddonsSelectionPopup"
             x:Name="Root"
             BackgroundColor="#80000000"
             HorizontalOptions="FillAndExpand"
             VerticalOptions="FillAndExpand"
             ZIndex="2000"
             IsVisible="{Binding IsAddonsPopupVisible}">

    <!-- Overlay Grid to emulate ConnectPOSItemToInventory layout -->
    <Grid HorizontalOptions="FillAndExpand"
          VerticalOptions="FillAndExpand"
          RowDefinitions="*,Auto,*"
          ColumnDefinitions="*,Auto,*">

        <!-- Transparent background click close -->
        <BoxView Grid.RowSpan="3" Grid.ColumnSpan="3" BackgroundColor="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding CloseAddonPopupCommand}" />
            </BoxView.GestureRecognizers>
        </BoxView>


        <!-- Center Popup -->
        <Frame Grid.Row="1" Grid.Column="1" Style="{StaticResource CenteredPopupFrame}" BackgroundColor="#F8E8D7">

            <!-- MAIN GRID FOR HEADER, CONTENT, FOOTER -->
            <Grid RowSpacing="20" RowDefinitions="Auto,*,Auto">

                <!-- HEADER -->
                <!-- Header (match InputIngredientsAmountUsed styling) -->
                <VerticalStackLayout Grid.Row="0" Spacing="10">
                    <Label Text="Select Addons"
                           FontSize="28"
                           FontAttributes="Bold"
                           TextColor="#4A3F35"
                           HorizontalOptions="Center" />
                    <Label Text="Choose addons, set amount, unit, and price."
                           FontSize="16"
                           TextColor="#7B6F63"
                           HorizontalOptions="Center" />
                </VerticalStackLayout>

                <!-- CONTENT (table layout copied from InputIngredientsAmountUsed, with extra Price column) -->
                <Grid Grid.Row="1" Padding="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Fixed Table Header -->
                    <Grid Grid.Row="0" BackgroundColor="#D6BCA8" Padding="15,8" Margin="0,0,0,0">
                        <Grid ColumnDefinitions="40, *, 100, 80, 80, 80, 80, 100, 80, 100">
                            <Label Grid.Column="0" Text="ID" FontAttributes="Bold" FontSize="14" TextColor="Black" HorizontalOptions="Center"/>
                            <Label Grid.Column="1" Text="Item Name" FontAttributes="Bold" FontSize="14" TextColor="Black" HorizontalOptions="Start"/>
                            <Label Grid.Column="2" Text="Category" FontAttributes="Bold" FontSize="14" TextColor="Black" HorizontalOptions="Center"/>
                            <Label Grid.Column="3" Text="Stock" FontAttributes="Bold" FontSize="14" TextColor="Black" HorizontalOptions="Center"/>
                            <Label Grid.Column="4" Text="Unit" FontAttributes="Bold" FontSize="14" TextColor="Black" HorizontalOptions="Center"/>
                            <Label Grid.Column="5" Text="Min Qty" FontAttributes="Bold" FontSize="14" TextColor="Black" HorizontalOptions="Center"/>
                            <Label Grid.Column="6" Text="Status" FontAttributes="Bold" FontSize="14" TextColor="Black" HorizontalOptions="Center"/>
                            <Label Grid.Column="7" Text="Amount" FontAttributes="Bold" FontSize="14" TextColor="Black" HorizontalOptions="Center"/>
                            <Label Grid.Column="8" Text="UoM" FontAttributes="Bold" FontSize="14" TextColor="Black" HorizontalOptions="Center"/>
                            <Label Grid.Column="9" Text="Price" FontAttributes="Bold" FontSize="14" TextColor="Black" HorizontalOptions="Center"/>
                        </Grid>
                    </Grid>

                    <!-- Addons Data (use CollectionView's own vertical scrolling) -->
                    <CollectionView Grid.Row="1"
                                    ItemsSource="{Binding AvailableAddons}"
                                    ItemsLayout="VerticalList"
                                    VerticalOptions="FillAndExpand">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid BackgroundColor="White" 
                                      Padding="15,8"
                                      Margin="0,0,0,1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="40" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="100" />
                                        </Grid.ColumnDefinitions>

                                        <!-- ID -->
                                        <!-- Checkbox + ID -->
                                        <HorizontalStackLayout Grid.Column="0" Spacing="8" VerticalOptions="Center">
                                            <CheckBox IsChecked="{Binding IsSelected}" />
                                            <Label Text="{Binding itemID}" FontSize="12" TextColor="Black" HorizontalOptions="Center" VerticalOptions="Center" />
                                        </HorizontalStackLayout>

                                        <!-- Item Name -->
                                        <Label Grid.Column="1" Text="{Binding itemName}" FontSize="12" TextColor="Black" VerticalOptions="Center" HorizontalOptions="Start" />

                                        <!-- Category -->
                                        <Label Grid.Column="2" Text="{Binding itemCategory}" FontSize="12" TextColor="Black" VerticalOptions="Center" HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                                        <!-- Stock -->
                                        <Label Grid.Column="3" Text="{Binding itemQuantity}" FontSize="12" TextColor="Black" VerticalOptions="Center" HorizontalOptions="Center" />

                                        <!-- Unit -->
                                        <Label Grid.Column="4" Text="{Binding unitOfMeasurement}" FontSize="12" TextColor="Black" VerticalOptions="Center" HorizontalOptions="Center" />

                                        <!-- Min Quantity -->
                                        <Label Grid.Column="5" Text="{Binding minimumQuantity}" FontSize="12" TextColor="Black" VerticalOptions="Center" HorizontalOptions="Center" />

                                        <!-- Status -->
                                        <Label Grid.Column="6" Text="{Binding StockText}" FontSize="12" TextColor="Black" VerticalOptions="Center" HorizontalOptions="Center" />

                                        <!-- Amount Input -->
                                        <Entry Grid.Column="7" Text="{Binding InputAmount}" TextColor="Black" FontSize="12" Keyboard="Numeric" HorizontalTextAlignment="Center" BackgroundColor="#F8F8F8" VerticalOptions="Center" />

                                        <!-- UoM Picker -->
                                        <Picker Grid.Column="8" SelectedItem="{Binding InputUnit}" TextColor="Black" ItemsSource="{Binding AllowedUnits}" FontSize="12" HorizontalOptions="Center" VerticalOptions="Center" WidthRequest="70" />

                                        <!-- Addon Price (extra vs ingredients UI) -->
                                        <Entry Grid.Column="9" Text="{Binding AddonPrice}" FontSize="12" TextColor="Black" Keyboard="Numeric" HorizontalTextAlignment="Center" BackgroundColor="#F8F8F8" VerticalOptions="Center" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Grid>

                <!-- Footer Buttons (match sizing/styles) -->
                <HorizontalStackLayout Grid.Row="2"
                                       HorizontalOptions="End"
                                       Spacing="15"
                                       Margin="0,10,0,0">
                    <Button Text="Back"
                            BackgroundColor="#EFEFEF"
                            TextColor="Black"
                            CornerRadius="14"
                            WidthRequest="120"
                            HeightRequest="45"
                            Command="{Binding CloseAddonPopupCommand}"/>
                    <Button Text="Preview"
                            BackgroundColor="#E6DE9D"
                            TextColor="Black"
                            CornerRadius="14"
                            WidthRequest="120"
                            HeightRequest="45"
                            Command="{Binding ConfirmAddonSelectionCommand}"/>
                </HorizontalStackLayout>
            </Grid>
        </Frame>
    </Grid>
</ContentView>
