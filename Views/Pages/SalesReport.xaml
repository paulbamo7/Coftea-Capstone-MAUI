<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui" 
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             x:Class="Coftea_Capstone.Views.Pages.SalesReport" 
             xmlns:vm="clr-namespace:Coftea_Capstone.ViewModel" 
             xmlns:views="clr-namespace:Coftea_Capstone.Views.Pages"
             xmlns:charts="clr-namespace:Coftea_Capstone.Views.Controls"
             xmlns:otherViews="clr-namespace:Coftea_Capstone.Views.Controls" 
             xmlns:converters="clr-namespace:Coftea_Capstone.ViewModel.Others"
             Shell.TabBarIsVisible="False" 
             BackgroundColor="#C1A892">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InvertBoolConverter x:Key="InvertBoolConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid ColumnDefinitions="200, *" RowDefinitions="*">

        <!-- Sidebar Navigation -->
        <views:NavigationBar Grid.Column="0" />
        
        <!-- Main Content -->
        <ScrollView Grid.Column="1">
            <VerticalStackLayout Padding="20" Spacing="16">
                <!-- Top Bar with category chips -->
                <Grid ColumnDefinitions="*,Auto,Auto" VerticalOptions="Center" ColumnSpacing="16">
                    <VerticalStackLayout>
                        <Label Text="Welcome back, Admin" FontSize="20"/>
                        <HorizontalStackLayout Spacing="8">
                            <Button Text="Overview" Padding="12,8" Command="{Binding SelectCategoryCommand}" CommandParameter="Overview"/>
                            <Button Text="Americano" Padding="12,8" Command="{Binding SelectCategoryCommand}" CommandParameter="Americano"/>
                            <Button Text="Cafe Latte" Padding="12,8" Command="{Binding SelectCategoryCommand}" CommandParameter="Cafe Latte"/>
                            <Button Text="Fruit and Soda Mix" Padding="12,8" Command="{Binding SelectCategoryCommand}" CommandParameter="Fruit and Soda Mix"/>
                            <Button Text="Frappe" Padding="12,8" Command="{Binding SelectCategoryCommand}" CommandParameter="Frappe"/>
                            <Button Text="Milktea" Padding="12,8" Command="{Binding SelectCategoryCommand}" CommandParameter="Milktea"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                    <ImageButton Source="settings.png" Grid.Column="1" WidthRequest="30" HeightRequest="30" Command="{Binding Source={x:Static Application.Current}, Path=SettingsPopup.ShowSettingsPopupCommand}"/>
                    <ImageButton Source="usericon.png" Grid.Column="2" WidthRequest="40" HeightRequest="40"/>
                </Grid>

                <!-- KPIs Row -->
                <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="12">
                    <Frame BackgroundColor="#F5E6D8" CornerRadius="12" Padding="12">
                        <VerticalStackLayout>
                            <Label Text="Active Days" FontAttributes="Bold"/>
                            <Label Text="{Binding ActiveDays}" FontSize="24"/>
                        </VerticalStackLayout>
                    </Frame>
                    <Frame BackgroundColor="#F5E6D8" CornerRadius="12" Padding="12" Grid.Column="1">
                        <VerticalStackLayout>
                            <Label Text="Overall Most Bought Today" FontAttributes="Bold"/>
                            <Label Text="{Binding MostBoughtToday}" FontSize="24"/>
                        </VerticalStackLayout>
                    </Frame>
                    <Frame BackgroundColor="#F5E6D8" CornerRadius="12" Padding="12" Grid.Column="2">
                        <VerticalStackLayout>
                            <Label Text="Trending Today" FontAttributes="Bold"/>
                            <Label Text="{Binding TrendingToday}" FontSize="24"/>
                        </VerticalStackLayout>
                    </Frame>
                    <Frame BackgroundColor="#F5E6D8" CornerRadius="12" Padding="12" Grid.Column="3">
                        <VerticalStackLayout>
                            <Label Text="Total Sales Today" FontAttributes="Bold"/>
                            <Label Text="{Binding TotalSalesToday, StringFormat='P {0}'}" FontSize="24"/>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>

                <!-- Orders Cards -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <Frame BackgroundColor="#FFFFFF" CornerRadius="12" Padding="12" IsVisible="{Binding ShowCoffee}">
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame" Binding="{Binding ShowMilktea}" Value="False">
                                <Setter Property="Grid.ColumnSpan" Value="2" />
                            </DataTrigger>
                        </Frame.Triggers>
                        <VerticalStackLayout>
                            <Label Text="Total Orders Today" FontAttributes="Bold"/>
                            <Label Text="{Binding TotalOrdersToday}" FontSize="24"/>
                        </VerticalStackLayout>
                    </Frame>
                    <Frame BackgroundColor="#FFFFFF" CornerRadius="12" Padding="12" Grid.Column="1" IsVisible="{Binding ShowMilktea}">
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame" Binding="{Binding ShowCoffee}" Value="False">
                                <Setter Property="Grid.ColumnSpan" Value="2" />
                                <Setter Property="Grid.Column" Value="0" />
                            </DataTrigger>
                        </Frame.Triggers>
                        <VerticalStackLayout>
                            <Label Text="Total Orders This Week" FontAttributes="Bold"/>
                            <Label Text="{Binding TotalOrdersThisWeek}" FontSize="24"/>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>

                <!-- Top Today Panels with charts -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <Frame BackgroundColor="#FFFFFF" CornerRadius="12" Padding="12" IsVisible="{Binding ShowCoffee}">
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame" Binding="{Binding ShowMilktea}" Value="False">
                                <Setter Property="Grid.ColumnSpan" Value="2" />
                            </DataTrigger>
                        </Frame.Triggers>
                        <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">
                            <Label Text="Top 3 Popular Coffee Today" FontAttributes="Bold"/>
                            <Label Text="{Binding TopCoffeeTodayOrders, StringFormat='{0} Orders'}" Grid.Column="1"/>
                            <GraphicsView x:Name="CoffeePie" HeightRequest="180" Grid.Row="1" Grid.ColumnSpan="2"/>
                            <CollectionView ItemsSource="{Binding TopCoffeeToday}" HeightRequest="100" Grid.Row="2" Grid.ColumnSpan="2">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Text="{Binding Name}"/>
                                            <Label Text="{Binding Count}" Grid.Column="1"/>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </Grid>
                    </Frame>
                    <Frame BackgroundColor="#FFFFFF" CornerRadius="12" Padding="12" Grid.Column="1" IsVisible="{Binding ShowMilktea}">
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame" Binding="{Binding ShowCoffee}" Value="False">
                                <Setter Property="Grid.ColumnSpan" Value="2" />
                                <Setter Property="Grid.Column" Value="0" />
                            </DataTrigger>
                        </Frame.Triggers>
                        <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">
                            <Label Text="Top 3 Popular Milktea Today" FontAttributes="Bold"/>
                            <Label Text="{Binding TopMilkteaTodayOrders, StringFormat='{0} Orders'}" Grid.Column="1"/>
                            <GraphicsView x:Name="MilkTeaPie" HeightRequest="180" Grid.Row="1" Grid.ColumnSpan="2"/>
                            <CollectionView ItemsSource="{Binding TopMilkteaToday}" HeightRequest="100" Grid.Row="2" Grid.ColumnSpan="2">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Text="{Binding Name}"/>
                                            <Label Text="{Binding Count}" Grid.Column="1"/>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </Grid>
                    </Frame>
                </Grid>

                <!-- Weekly Trends with bar charts -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <Frame BackgroundColor="#FFFFFF" CornerRadius="12" Padding="12" IsVisible="{Binding ShowCoffee}">
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame" Binding="{Binding ShowMilktea}" Value="False">
                                <Setter Property="Grid.ColumnSpan" Value="2" />
                            </DataTrigger>
                        </Frame.Triggers>
                        <VerticalStackLayout>
                            <Label Text="Top Coffee Trends Weekly" FontAttributes="Bold"/>
                            <GraphicsView x:Name="CoffeeBar" HeightRequest="180"/>
                            <CollectionView ItemsSource="{Binding TopCoffeeWeekly}" HeightRequest="100">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Text="{Binding Name}"/>
                                            <Label Text="{Binding Count}" Grid.Column="1"/>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Frame>
                    <Frame BackgroundColor="#FFFFFF" CornerRadius="12" Padding="12" Grid.Column="1" IsVisible="{Binding ShowMilktea}">
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame" Binding="{Binding ShowCoffee}" Value="False">
                                <Setter Property="Grid.ColumnSpan" Value="2" />
                                <Setter Property="Grid.Column" Value="0" />
                            </DataTrigger>
                        </Frame.Triggers>
                        <VerticalStackLayout>
                            <Label Text="Top Milktea Trends Weekly" FontAttributes="Bold"/>
                            <GraphicsView x:Name="MilkTeaBar" HeightRequest="180"/>
                            <CollectionView ItemsSource="{Binding TopMilkteaWeekly}" HeightRequest="100">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Text="{Binding Name}"/>
                                            <Label Text="{Binding Count}" Grid.Column="1"/>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>
            </VerticalStackLayout>
        </ScrollView>
        
        <!-- Settings Popup (shared) -->
        <views:Settings BindingContext="{Binding Source={x:Static Application.Current}, Path=SettingsPopup}" Grid.ColumnSpan="2"/>
        
        <!-- Manage POS Options Popup -->
        <otherViews:ManagePOSOptions BindingContext="{Binding Source={x:Static Application.Current}, Path=ManagePOSPopup}" Grid.ColumnSpan="2"/>
        <otherViews:EditProductPopup BindingContext="{Binding Source={x:Static Application.Current}, Path=ManagePOSPopup.EditProductPopupVM}" Grid.ColumnSpan="2"/>
        
        <!-- Manage Inventory Options Popup -->
        <otherViews:ManageInventoryOptions BindingContext="{Binding Source={x:Static Application.Current}, Path=ManageInventoryPopup}" Grid.ColumnSpan="2"/>
        <otherViews:AddItemToInventory BindingContext="{Binding Source={x:Static Application.Current}, Path=ManageInventoryPopup.AddItemToInventoryVM}" Grid.ColumnSpan="2"/>
        
        <!-- Retry Connection Popup -->
        <otherViews:RetryConnectionPopup x:Name="RetryConnectionPopup" Grid.ColumnSpan="2"/>
    </Grid>
</ContentPage>