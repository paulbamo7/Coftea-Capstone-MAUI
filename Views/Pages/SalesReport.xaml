<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui" 
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             x:Class="Coftea_Capstone.Views.Pages.SalesReport" 
             xmlns:vm="clr-namespace:Coftea_Capstone.ViewModel" 
             xmlns:views="clr-namespace:Coftea_Capstone.Views.Pages"
             xmlns:otherViews="clr-namespace:Coftea_Capstone.Views.Controls" 
             xmlns:converters="clr-namespace:Coftea_Capstone.ViewModel.Others"
             Shell.TabBarIsVisible="False" 
             BackgroundColor="#C1A892">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InvertBoolConverter x:Key="InvertBoolConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid ColumnDefinitions="200, *" RowDefinitions="*">

        <!-- Sidebar Navigation -->
        <views:NavigationBar Grid.Column="0" />
        
        <!-- Main Content -->
        <VerticalStackLayout Grid.Column="1" Padding="20">
            <VerticalStackLayout Spacing="20">
                <!-- Top Bar -->
                <Grid ColumnDefinitions="*, Auto, Auto, Auto" VerticalOptions="Center" ColumnSpacing="25">
                    <Label Text="Sales Report" FontSize="32" FontAttributes="Bold" VerticalOptions="Center"/>
                    <ImageButton Source="settings.png" Grid.Column="2" WidthRequest="30" HeightRequest="30" Command="{Binding ShowSettingsPopupCommand}"/>
                    <ImageButton Source="usericon.png" Grid.Column="3" WidthRequest="40" HeightRequest="40"/>
                </Grid>
                
                <!-- Loading Indicator -->
                <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Start" IsVisible="{Binding IsLoading}">
                    <ActivityIndicator IsRunning="{Binding IsLoading}" IsVisible="{Binding IsLoading}" />
                    <Label Text="{Binding StatusMessage}" TextColor="{Binding HasError}" FontSize="14" HorizontalOptions="Center" />
                </VerticalStackLayout>

                <!-- Sales Report Content -->
                <Frame BackgroundColor="White" CornerRadius="15" Padding="20" IsVisible="{Binding IsLoading, Converter={StaticResource InvertBoolConverter}}">
                    <CollectionView ItemsSource="{Binding SalesReports}" BackgroundColor="Transparent">
                        <CollectionView.Header>
                            <Grid ColumnDefinitions="1*, 1*, 1*, 1*" BackgroundColor="#DAAB97" Padding="15">
                                <Label Text="Report ID" FontSize="15" FontAttributes="Bold" VerticalOptions="Center" HorizontalOptions="Center"/>
                                <Label Text="Order Item ID" FontSize="15" FontAttributes="Bold" VerticalOptions="Center" HorizontalOptions="Center" Grid.Column="1"/>
                                <Label Text="Date" FontSize="15" FontAttributes="Bold" VerticalOptions="Center" HorizontalOptions="Center" Grid.Column="2"/>
                                <Label Text="Total Orders" FontSize="15" FontAttributes="Bold" VerticalOptions="Center" HorizontalOptions="Center" Grid.Column="3"/>
                            </Grid>
                        </CollectionView.Header>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="10" Margin="0,5,0,5" CornerRadius="10" BackgroundColor="White">
                                    <Grid ColumnDefinitions="1*, 1*, 1*, 1*" VerticalOptions="Center">
                                        <Label Text="{Binding ReportID}" Grid.Column="0" VerticalOptions="Center" HorizontalOptions="Center"/>
                                        <Label Text="{Binding OrderItemID}" Grid.Column="1" VerticalOptions="Center" HorizontalOptions="Center"/>
                                        <Label Text="{Binding ReportDate, StringFormat='{0:MM/dd/yyyy}'}" Grid.Column="2" VerticalOptions="Center" HorizontalOptions="Center"/>
                                        <Label Text="{Binding TotalOrder}" Grid.Column="3" VerticalOptions="Center" HorizontalOptions="Center"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Frame>
            </VerticalStackLayout>
        </VerticalStackLayout>
        
        <!-- Settings Popup -->
        <views:Settings BindingContext="{Binding .}" Grid.ColumnSpan="2"/>
        
        <!-- Manage POS Options Popup -->
        <otherViews:ManagePOSOptions BindingContext="{Binding Source={x:Static Application.Current}, Path=ManagePOSPopup}" Grid.ColumnSpan="2"/>
        <otherViews:EditProductPopup BindingContext="{Binding Source={x:Static Application.Current}, Path=ManagePOSPopup.EditProductPopupVM}" Grid.ColumnSpan="2"/>
        
        <!-- Manage Inventory Options Popup -->
        <otherViews:ManageInventoryOptions BindingContext="{Binding Source={x:Static Application.Current}, Path=ManageInventoryPopup}" Grid.ColumnSpan="2"/>
        <otherViews:AddItemToInventory BindingContext="{Binding Source={x:Static Application.Current}, Path=ManageInventoryPopup.AddItemToInventoryVM}" Grid.ColumnSpan="2"/>
        
        <!-- Retry Connection Popup -->
        <otherViews:RetryConnectionPopup x:Name="RetryConnectionPopup" Grid.ColumnSpan="2"/>
    </Grid>
</ContentPage>