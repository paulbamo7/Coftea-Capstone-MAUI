<ContentView
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:otherViews="clr-namespace:Coftea_Capstone.Views.Controls"
    x:Class="Coftea_Capstone.Views.Pages.Settings"
    BackgroundColor="#80000000"
    x:Name="SettingsPop"
    IsVisible="{Binding IsSettingsPopupVisible}"
    InputTransparent="False">

    <Grid VerticalOptions="Fill" HorizontalOptions="Fill" InputTransparent="False">
        <!-- Tap outside to close -->
        <Grid.GestureRecognizers>
            <TapGestureRecognizer Command="{Binding CloseSettingsPopupCommand}" />
        </Grid.GestureRecognizers>

        <!-- Main Popup Frame (responsive) -->
        <Frame
            VerticalOptions="Center"
            HorizontalOptions="Center"
            Padding="30"
            BackgroundColor="#F8E8D7"
            CornerRadius="20"
            HasShadow="True"
            WidthRequest="580"
            MaximumWidthRequest="580"
            MinimumWidthRequest="320"
            HeightRequest="650"
            MaximumHeightRequest="700"
            InputTransparent="False">

            <Frame.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnFrameTapped" />
            </Frame.GestureRecognizers>

            <ScrollView>
                <VerticalStackLayout Spacing="10">
                <!-- Header -->
                <!-- Top Bar with Settings Title and Connectivity Indicator -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,0,0,20">
                    <Label Text="Settings"
                           Grid.Column="0"
                           FontSize="30"
                           FontAttributes="Bold"
                           FontFamily="Montserrat-Black"
                           TextColor="#5B4F45"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
                    
                    <!-- Connectivity Status Indicator -->
                    <otherViews:ConnectivityStatusIndicator Grid.Column="1" VerticalOptions="Center" HorizontalOptions="End"/>
                </Grid>

                <!-- Feature buttons (wrap on small screens) -->
                    <FlexLayout Direction="Row" Wrap="Wrap" AlignItems="Center" JustifyContent="Center" AlignContent="Start" Margin="0,0,0,0">

                        <VerticalStackLayout HorizontalOptions="Center" Spacing="15" Margin="15">
                            <Frame CornerRadius="20" HasShadow="True" BackgroundColor="#A89580" Padding="20">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding OpenUserManagementCommand}" />
                                </Frame.GestureRecognizers>
                                <Image Source="usermanagementicon.png"
                                   HeightRequest="80"
                                   WidthRequest="80"
                                   Aspect="AspectFit"
                                   InputTransparent="True" />
                            </Frame>
                            <Label Text="User Management"
                               HorizontalOptions="Center"
                               FontSize="14"
                               FontAttributes="Bold"
                               FontFamily="OpenSansSemibold"
                               TextColor="#5B4F45"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout HorizontalOptions="Center" Spacing="15" Margin="15">
                            <Frame CornerRadius="20" HasShadow="True" BackgroundColor="#A89580" Padding="20">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding OpenManagePOSOptionsCommand}" />
                                </Frame.GestureRecognizers>
                                <Image Source="manageposicon.png"
                                   HeightRequest="80"
                                   WidthRequest="80"
                                   Aspect="AspectFit"
                                   InputTransparent="True" />
                            </Frame>
                            <Label Text="Manage POS Menu"
                               HorizontalOptions="Center"
                               FontSize="14"
                               FontAttributes="Bold"
                               FontFamily="OpenSansSemibold"
                               TextColor="#5B4F45"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout HorizontalOptions="Center" Spacing="15" Margin="15" IsVisible="{Binding CanManageInventory}">
                            <Frame CornerRadius="20" HasShadow="True" BackgroundColor="#A89580" Padding="20">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding OpenManageInventoryOptionsCommand}" />
                                </Frame.GestureRecognizers>
                                <Image Source="manageinventoryicon.png"
                                   HeightRequest="80"
                                   WidthRequest="80"
                                   Aspect="AspectFit"
                                   InputTransparent="True" />
                            </Frame>
                            <Label Text="Manage Inventory"
                               HorizontalOptions="Center"
                               FontSize="14"
                               FontAttributes="Bold"
                               FontFamily="OpenSansSemibold"
                               TextColor="#5B4F45"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout HorizontalOptions="Center" Spacing="15" Margin="15">
                            <Frame CornerRadius="20" HasShadow="True" BackgroundColor="#4A90E2" Padding="20">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SyncDatabaseCommand}" />
                                </Frame.GestureRecognizers>
                                <Grid>
                                    <!-- Sync Icon (using Unicode character as fallback) -->
                                    <Label Text="ðŸ”„"
                                       FontSize="60"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       InputTransparent="True"
                                       IsVisible="{Binding IsNotSyncing}" />
                                    <ActivityIndicator 
                                       IsRunning="{Binding IsSyncing}"
                                       IsVisible="{Binding IsSyncing}"
                                       Color="White"
                                       HeightRequest="60"
                                       WidthRequest="60" />
                                </Grid>
                            </Frame>
                            <Label Text="{Binding SyncButtonText}"
                               HorizontalOptions="Center"
                               FontSize="14"
                               FontAttributes="Bold"
                               FontFamily="OpenSansSemibold"
                               TextColor="#5B4F45"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout HorizontalOptions="Center" Spacing="15" Margin="15">
                            <Frame CornerRadius="20" HasShadow="True" BackgroundColor="#D9534F" Padding="20">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnLogoutClicked" />
                                </Frame.GestureRecognizers>
                                <Image Source="logouticon.png"
                                   HeightRequest="80"
                                   WidthRequest="80"
                                   Aspect="AspectFit"
                                   InputTransparent="True" />
                            </Frame>
                            <Label Text="Logout"
                               HorizontalOptions="Center"
                               FontSize="14"
                               FontAttributes="Bold"
                               FontFamily="OpenSansSemibold"
                               TextColor="#5B4F45"/>
                        </VerticalStackLayout>

                    </FlexLayout>

                    <!-- Close button at bottom -->
                <Button Text="Close"
                        Margin="0,15,0,0"
                        WidthRequest="140"
                        HeightRequest="50"
                        BackgroundColor="#BDAEA2"
                        TextColor="#5B4F45"
                        BorderColor="#8B7355"
                        BorderWidth="2"
                        FontAttributes="Bold"
                        FontSize="15"
                        CornerRadius="20"
                        HorizontalOptions="Center"
                        Command="{Binding CloseSettingsPopupCommand}"/>
                </VerticalStackLayout>
            </ScrollView>
        </Frame>
    </Grid>
</ContentView>
