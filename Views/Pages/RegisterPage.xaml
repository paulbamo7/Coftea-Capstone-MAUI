<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Coftea_Capstone.Views.Pages.RegisterPage"
             xmlns:vm="clr-namespace:Coftea_Capstone.ViewModel"
             xmlns:otherViews="clr-namespace:Coftea_Capstone.Views.Controls"
             xmlns:sys="clr-namespace:System;assembly=System.Runtime"
             Shell.NavBarIsVisible="False"
             >

    <ContentPage.BindingContext>
        <vm:RegisterPageViewModel/>
    </ContentPage.BindingContext>

    <!-- Background Gradient -->
    <ContentPage.Background>
        <LinearGradientBrush>
            <GradientStop Color="#C1A892" Offset="0.25" />
            <GradientStop Color="#5B4F45" Offset="0.85" />
        </LinearGradientBrush>
    </ContentPage.Background>

    <!-- Main Grid containing all content -->
    <Grid>
        <ScrollView VerticalOptions="Center" HorizontalOptions="Center">
            <HorizontalStackLayout HorizontalOptions="Center">
                <Grid RowDefinitions="Auto">
                    <FlexLayout Direction="Row" Wrap="NoWrap" AlignItems="Start" JustifyContent="Center" AlignContent="Start">
                        <Frame BackgroundColor="#BDAEA2"
                               Padding="25,65,25,0"
                               CornerRadius="0"
                               BorderColor="Gray"
                               HasShadow="False"
                               WidthRequest="420"
                               HeightRequest="620">

                            <VerticalStackLayout Spacing="12">
                                <HorizontalStackLayout Spacing="10">
                                    <Border Stroke="Gray" StrokeShape="RoundRectangle 12" StrokeThickness="2" HeightRequest="45" WidthRequest="179" >
                                        <Entry Placeholder="First Name" PlaceholderColor="White" Text="{Binding FirstName}"/>
                                    </Border>
                                    <Border Stroke="Gray" StrokeShape="RoundRectangle 12" StrokeThickness="2" HeightRequest="45" WidthRequest="179">
                                        <Entry Placeholder="Last Name" PlaceholderColor="White" Text="{Binding LastName}" />
                                    </Border>
                                </HorizontalStackLayout>

                                <Border Stroke="Gray" StrokeShape="RoundRectangle 12" StrokeThickness="2" HeightRequest="45" WidthRequest="370" Margin="15">
                                    <Entry Placeholder="Enter Email" Keyboard="Email" PlaceholderColor="White" Text="{Binding Email}"/>
                                </Border>
                                <Border Stroke="Gray" StrokeShape="RoundRectangle 12" StrokeThickness="2" HeightRequest="45" WidthRequest="370">
                                    <Grid>
                                        <Entry x:Name="RegisterPasswordEntry" Placeholder="Enter Password" IsPassword="True" PlaceholderColor="White"  Text="{Binding Password}"/>
                                        <ImageButton Source="show.png"
                                                    WidthRequest="24"
                                                    HeightRequest="24"
                                                    Padding="0"
                                                    BackgroundColor="Transparent"
                                                    HorizontalOptions="End"
                                                    VerticalOptions="Center"
                                                    Clicked="OnToggleRegisterPasswordVisibility" />
                                    </Grid>
                                </Border>

                                <Border Stroke="Gray" StrokeShape="RoundRectangle 12" StrokeThickness="2" HeightRequest="45" WidthRequest="370">
                                    <Grid>
                                        <Entry x:Name="RegisterConfirmPasswordEntry" Placeholder="Confirm Password" IsPassword="True" PlaceholderColor="White" Text="{Binding ConfirmPassword}"/>
                                        <ImageButton Source="show.png"
                                                    WidthRequest="24"
                                                    HeightRequest="24"
                                                    Padding="0"
                                                    BackgroundColor="Transparent"
                                                    HorizontalOptions="End"
                                                    VerticalOptions="Center"
                                                    Clicked="OnToggleRegisterConfirmPasswordVisibility" />
                                    </Grid>
                                </Border>
                                <Border Stroke="Gray" StrokeShape="RoundRectangle 12" StrokeThickness="2" HeightRequest="45" WidthRequest="370">
                                    <DatePicker Date="{Binding Birthday}" 
                                               Format="MM/dd/yyyy"
                                               MinimumDate="01/01/1900"
                                               x:Name="BirthdayDatePicker"/>
                                </Border>

                                <Border Stroke="Gray" StrokeShape="RoundRectangle 12" StrokeThickness="2" HeightRequest="45" WidthRequest="370">
                                    <Entry Placeholder="Phone Number" Keyboard="Telephone" PlaceholderColor="White" Text="{Binding PhoneNumber}" />
                                </Border>
                                <Border Stroke="Gray" StrokeShape="RoundRectangle 12" StrokeThickness="2" HeightRequest="45" WidthRequest="370">
                                    <Entry Placeholder="Address" PlaceholderColor="White" Text="{Binding Address}"/>
                                </Border>
                                <!-- Checkbox for T&C -->
                                <HorizontalStackLayout>
                                    <CheckBox IsChecked="{Binding IsTermsAccepted}"/>
                                    <Label Text="I agree to the " VerticalOptions="Center" />
                                    <Label Text="Terms and Conditions" TextColor="Blue" VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                                <!-- Back Button -->
                                <HorizontalStackLayout HorizontalOptions="Center" Margin="0,0,0,10" Spacing="20">
                                    <Grid ColumnDefinitions="*,*" ColumnSpacing="20">
                                        <Button Text="← Back to Login" 
                                                Grid.Column="0"
                                                BackgroundColor="#5B4F45"
                                                TextColor="White" 
                                                FontSize="16"
                                                Command="{Binding BackToLoginCommand}"
                                                HorizontalOptions="Center"/>
                                        <!-- Submit Button -->
                                        <Button Text="Register"
                                                Grid.Column="1"
                                                BackgroundColor="#5B4F45"
                                                TextColor="White"
                                                FontSize="16"
                                                Command="{Binding RegisterCommand}"
                                                CornerRadius="10"
                                                HorizontalOptions="Center"/>
                                    </Grid>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Frame>

                        <!-- Right Frame (Logo) -->
                        <Frame BackgroundColor="#C0BBB6"
                               Padding="45,0,45,0"
                               CornerRadius="0"
                               HasShadow="False"
                               WidthRequest="420"
                               HeightRequest="620">
                            <Image Source="coftea_logo.png"
                                   HeightRequest="250"
                                   HorizontalOptions="Center"/>
                        </Frame>
                    </FlexLayout>
                </Grid>
            </HorizontalStackLayout>
        </ScrollView>

        <!-- Retry Connection Popup - Overlay at root level -->
        <otherViews:RetryConnectionPopup x:Name="RetryConnectionPopup" 
                                         Grid.RowSpan="1" 
                                         Grid.ColumnSpan="1" />
    </Grid>
</ContentPage>