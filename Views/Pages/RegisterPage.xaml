<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Coftea_Capstone.Views.Pages.RegisterPage"
             xmlns:vm="clr-namespace:Coftea_Capstone.ViewModel"
             xmlns:otherViews="clr-namespace:Coftea_Capstone.Views.Controls"
             xmlns:sys="clr-namespace:System;assembly=System.Runtime"
             xmlns:converters="clr-namespace:Coftea_Capstone.ViewModel.Others"
             Shell.NavBarIsVisible="False"
             >

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:BoolToColorConverter x:Key="BoolToColorConverter" />
            <converters:InvertBoolConverter x:Key="InvertBoolConverter" />
            <converters:StringToBoolConverter x:Key="StringToBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.BindingContext>
        <vm:RegisterPageViewModel/>
    </ContentPage.BindingContext>

    <!-- Background Gradient -->
    <ContentPage.Background>
        <LinearGradientBrush>
            <GradientStop Color="#C1A892" Offset="0.25" />
            <GradientStop Color="#5B4F45" Offset="0.85" /> 
        </LinearGradientBrush>
    </ContentPage.Background>

    <!-- Main Grid containing all content -->
    <Grid>
        <ScrollView VerticalOptions="Center" HorizontalOptions="Center"
                   Orientation="Vertical" 
                   VerticalScrollBarVisibility="Default">
            <HorizontalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                
                <!-- Left Frame: Registration Form -->
                <Frame BackgroundColor="#BDAEA2"
                       Padding="25,60,25,25"
                       CornerRadius="0"
                       BorderColor="#8B7355"
                       HasShadow="True"
                       WidthRequest="420"
                       HeightRequest="620">

                    <ScrollView Orientation="Vertical" VerticalScrollBarVisibility="Default">
                        <VerticalStackLayout Spacing="12">
                            <!-- First Row: Name Fields -->
                            <HorizontalStackLayout Spacing="10">
                                <Border Stroke="#8B7355" StrokeShape="RoundRectangle 15" StrokeThickness="2" HeightRequest="55" WidthRequest="179" BackgroundColor="#F5F1ED">
                                    <Entry Placeholder="First Name" 
                                           PlaceholderColor="#8B7355" 
                                           TextColor="#5B4F45"
                                           FontFamily="MontserratBlack"
                                           FontSize="16"
                                           Margin="20,0"
                                           Text="{Binding FirstName}"/>
                                </Border>
                                <Border Stroke="#8B7355" StrokeShape="RoundRectangle 15" StrokeThickness="2" HeightRequest="55" WidthRequest="179" BackgroundColor="#F5F1ED">
                                    <Entry Placeholder="Last Name" 
                                           PlaceholderColor="#8B7355" 
                                           TextColor="#5B4F45"
                                           FontFamily="MontserratBlack"
                                           FontSize="16"
                                           Margin="20,0"
                                           Text="{Binding LastName}" />
                                </Border>
                            </HorizontalStackLayout>

                            <!-- Second Row: Email -->
                            <Border Stroke="#8B7355" StrokeShape="RoundRectangle 15" StrokeThickness="2" HeightRequest="55" WidthRequest="370" Margin="15" BackgroundColor="#F5F1ED">
                                <Entry Placeholder="Enter Email" 
                                       Keyboard="Email" 
                                       PlaceholderColor="#8B7355" 
                                       TextColor="#5B4F45"
                                       FontFamily="MontserratBlack"
                                       FontSize="16"
                                       Margin="20,0"
                                       Text="{Binding Email}"/>
                            </Border>

                            <!-- Email Validation Message -->
                            <Frame IsVisible="{Binding EmailValidationMessage, Converter={StaticResource StringToBoolConverter}}" 
                                   BackgroundColor="#FFE8E8" 
                                   Padding="20,10" 
                                   CornerRadius="10" 
                                   Margin="15,5,15,0"
                                   HasShadow="False">
                                <StackLayout Orientation="Horizontal" Spacing="8">
                                    <Label Text="✗" TextColor="#D9534F" FontSize="14" FontFamily="MontserratBlack"/>
                                    <Label Text="{Binding EmailValidationMessage}" FontSize="13" TextColor="#D9534F" FontFamily="MontserratBlack"/>
                                </StackLayout>
                            </Frame>
                                        
                            <!-- Third Row: Password -->
                            <Border Stroke="#8B7355" StrokeShape="RoundRectangle 15" StrokeThickness="2" HeightRequest="55" WidthRequest="370" BackgroundColor="#F5F1ED">
                                <Grid>
                                    <Entry x:Name="RegisterPasswordEntry" 
                                           Placeholder="Enter Password" 
                                           IsPassword="True" 
                                           PlaceholderColor="#8B7355" 
                                           TextColor="#5B4F45"
                                           FontFamily="MontserratBlack"
                                           FontSize="16"
                                           Margin="20,0,60,0"
                                           Text="{Binding Password}"/>
                                    <ImageButton Source="show.png"
                                                WidthRequest="28"
                                                HeightRequest="28"
                                                Padding="0"
                                                BackgroundColor="Transparent"
                                                HorizontalOptions="End"
                                                VerticalOptions="Center"
                                                Margin="0,0,20,0"
                                                Clicked="OnToggleRegisterPasswordVisibility" />
                                </Grid>
                            </Border>

                            <!-- Password Requirements -->
                            <StackLayout Spacing="6" Margin="15,5,15,0" BackgroundColor="#F5F1ED" Padding="20,12" >
                                <Label Text="Password Requirements:" FontSize="14" TextColor="#5B4F45" FontFamily="MontserratBlack"/>
                                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="20" RowSpacing="8">
                                    <StackLayout Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="6">
                                        <Label Text="✓" TextColor="{Binding HasUppercase, Converter={StaticResource BoolToColorConverter}}" FontSize="14" FontFamily="MontserratBlack"/>
                                        <Label Text="Uppercase" FontSize="13" TextColor="#8B7355" FontFamily="MontserratBlack"/>
                                    </StackLayout>
                                    
                                    <StackLayout Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Spacing="6">
                                        <Label Text="✓" TextColor="{Binding HasLowercase, Converter={StaticResource BoolToColorConverter}}" FontSize="14" FontFamily="MontserratBlack"/>
                                        <Label Text="Lowercase" FontSize="13" TextColor="#8B7355" FontFamily="MontserratBlack"/>
                                    </StackLayout>
                                    
                                    <StackLayout Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Spacing="6">
                                        <Label Text="✓" TextColor="{Binding HasNumber, Converter={StaticResource BoolToColorConverter}}" FontSize="14" FontFamily="MontserratBlack"/>
                                        <Label Text="0-9" FontSize="13" TextColor="#8B7355" FontFamily="MontserratBlack"/>
                                    </StackLayout>
                                    
                                    <StackLayout Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Spacing="6">
                                        <Label Text="✓" TextColor="{Binding HasSpecialChar, Converter={StaticResource BoolToColorConverter}}" FontSize="14" FontFamily="MontserratBlack"/>
                                        <Label Text="Special character" FontSize="13" TextColor="#8B7355" FontFamily="MontserratBlack"/>
                                    </StackLayout>
                                    
                                    <StackLayout Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Spacing="6">
                                        <Label Text="✓" TextColor="{Binding HasMinLength, Converter={StaticResource BoolToColorConverter}}" FontSize="14" FontFamily="MontserratBlack"/>
                                        <Label Text="At least 8 characters long" FontSize="13" TextColor="#8B7355" FontFamily="MontserratBlack"/>
                                    </StackLayout>
                                </Grid>
                            </StackLayout>

                            <!-- Fourth Row: Confirm Password -->
                            <Border Stroke="#8B7355" StrokeShape="RoundRectangle 15" StrokeThickness="2" HeightRequest="55" WidthRequest="370" BackgroundColor="#F5F1ED">
                                <Grid>
                                    <Entry x:Name="RegisterConfirmPasswordEntry" 
                                           Placeholder="Confirm Password" 
                                           IsPassword="True" 
                                           PlaceholderColor="#8B7355" 
                                           TextColor="#5B4F45"
                                           FontFamily="MontserratBlack"
                                           FontSize="16"
                                           Margin="20,0,60,0"
                                           Text="{Binding ConfirmPassword}"/>
                                    <ImageButton Source="show.png"
                                                WidthRequest="28"
                                                HeightRequest="28"
                                                Padding="0"
                                                BackgroundColor="Transparent"
                                                HorizontalOptions="End"
                                                VerticalOptions="Center"
                                                Margin="0,0,20,0"
                                                Clicked="OnToggleRegisterConfirmPasswordVisibility" />
                                </Grid>
                            </Border>

                            <!-- Password Match Indicator -->
                            <StackLayout Orientation="Horizontal" Spacing="8" Margin="15,5,15,0" BackgroundColor="#F5F1ED" Padding="20,10" >
                                <Label Text="✓" TextColor="{Binding PasswordsMatch, Converter={StaticResource BoolToColorConverter}}" FontSize="14" FontFamily="MontserratBlack"/>
                                <Label Text="Passwords match" FontSize="13" TextColor="#8B7355" FontFamily="MontserratBlack"/>
                            </StackLayout>

                            <!-- Action Buttons -->
                            <Grid ColumnDefinitions="1.2*,*" ColumnSpacing="20" RowDefinitions="Auto" Margin="15,0,15,0">
                                <Button Grid.Column="0" 
                                        Text="← Back to Login" 
                                        BackgroundColor="#C1A892" 
                                        TextColor="#5B4F45" 
                                        FontSize="13"
                                        FontFamily="MontserratBlack"
                                        Command="{Binding BackToLoginCommand}"
                                        CornerRadius="15"
                                        Padding="15,15"
                                        BorderColor="#8B7355"
                                        BorderWidth="2"
                                        HeightRequest="55"/>
                                <Button Grid.Column="1" 
                                        Text="Register"
                                        BackgroundColor="#5B4F45"
                                        TextColor="White"
                                        FontSize="16"
                                        FontFamily="MontserratBlack"
                                        Command="{Binding RegisterCommand}"
                                        CornerRadius="15"
                                        Padding="30,15"
                                        HeightRequest="55"/>
                            </Grid>
                        </VerticalStackLayout>
                    </ScrollView>
                </Frame>

                <!-- Right Frame: Logo -->
                <Frame BackgroundColor="#C0BBB6"
                       Padding="45,0,45,0"
                       CornerRadius="0"
                       HasShadow="False"
                       WidthRequest="420"
                       HeightRequest="620">

                    <Image Source="coftea_logo.png"
                           HeightRequest="250"
                           MaximumWidthRequest="300"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Frame>

            </HorizontalStackLayout>
        </ScrollView>

        <!-- Retry Connection Popup - Overlay at root level -->
        <otherViews:RetryConnectionPopup x:Name="RetryConnectionPopup" 
                                         Grid.RowSpan="1" 
                                         Grid.ColumnSpan="1" />
    </Grid>
</ContentPage>