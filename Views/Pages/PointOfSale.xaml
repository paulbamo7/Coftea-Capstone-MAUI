<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Coftea_Capstone.Views.Pages.PointOfSale"
             xmlns:vm="clr-namespace:Coftea_Capstone.ViewModel"
             xmlns:view="clr-namespace:Coftea_Capstone.Views.Pages"
             xmlns:otherViews="clr-namespace:Coftea_Capstone.Views.Controls"
             Shell.NavBarIsVisible="False"      
             Shell.TabBarIsVisible="False"
             x:Name="POS"
             BackgroundColor="#D6BCA8">

    <Grid ColumnDefinitions="200, *" RowDefinitions="*">

        <!-- Sidebar Navigation -->
        <view:NavigationBar Grid.Column="0" />

        <!-- Main Content -->
        <Grid Grid.Column="1" Padding="20" RowDefinitions="Auto, Auto, *">

            <!-- Top Bar -->
            <Grid ColumnDefinitions="*, Auto, Auto, Auto, Auto" VerticalOptions="Center" ColumnSpacing="15" Grid.Row="0">
                <Label Text="Point Of Sale"  
                       FontSize="28" 
                       FontAttributes="Bold" 
                       FontFamily="MontserratBlack" 
                       VerticalOptions="Center"/>
                <Label x:Name="TimerLabel" 
                       Grid.Column="1"
                       VerticalOptions="Center" 
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="Black" />
                <SearchBar Placeholder="Search for something" 
                           Grid.Column="2" 
                           WidthRequest="250" 
                           HorizontalOptions="FillAndExpand"/>
                <ImageButton Source="settings.png" 
                             Grid.Column="3" 
                             WidthRequest="28" HeightRequest="28"
                             Command="{Binding SettingsPopup.ShowSettingsPopupCommand}" />
                <ImageButton Source="usericon.png" 
                             Grid.Column="4" 
                             WidthRequest="35" HeightRequest="35"/>
            </Grid>

            <!-- Menu Categories -->
            <ScrollView Orientation="Horizontal" Padding="0,15,0,0" HorizontalOptions="Center" Grid.Row="1">
                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Button Text="Frappe" FontAttributes="Bold" FontFamily="Roboto" TextColor="Black" FontSize="14" BackgroundColor="#897564" WidthRequest="120" HeightRequest="40"/>
                    <Button Text="Fruit/Soda" FontAttributes="Bold" FontFamily="Roboto" TextColor="Black" FontSize="14" BackgroundColor="#897564" WidthRequest="120" HeightRequest="40"/>
                    <Button Text="Milktea" FontAttributes="Bold" FontFamily="Roboto" TextColor="Black" FontSize="14" BackgroundColor="#897564" WidthRequest="120" HeightRequest="40"/>
                    <Button Text="Coffee" FontAttributes="Bold" FontFamily="Roboto" TextColor="Black" FontSize="14" BackgroundColor="#897564" WidthRequest="120" HeightRequest="40"/>
                </HorizontalStackLayout>
            </ScrollView>

            <!-- Main Content (Products + Cart) -->
            <Grid ColumnDefinitions="3*,2*" RowDefinitions="*" 
                  ColumnSpacing="15" 
                  VerticalOptions="FillAndExpand"
                  HorizontalOptions="FillAndExpand" Grid.Row="2">

                <!-- Products -->
                <Border Grid.Column="0"
                        StrokeShape="RoundRectangle 20" 
                        BackgroundColor="White" 
                        Margin="0,25,0,0"
                        VerticalOptions="Start"
                        HeightRequest="550"
                        HorizontalOptions="FillAndExpand">
                    <CollectionView ItemsSource="{Binding Products}"
                                    VerticalOptions="Fill"
                                    HorizontalOptions="FillAndExpand">
                        <CollectionView.ItemsLayout>
                            <GridItemsLayout Orientation="Vertical" Span="3" />
                        </CollectionView.ItemsLayout>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#D9D9D9" 
                                       CornerRadius="20" 
                                       Margin="10" 
                                       Padding="5"
                                       VerticalOptions="Fill"
                                       HorizontalOptions="Fill">
                                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                                        <!-- Product Image -->
                                        <Frame CornerRadius="20" Padding="0">
                                            <Image Source="{Binding ImageSet}" Aspect="AspectFill" HorizontalOptions="Fill" VerticalOptions="Fill"/>
                                        </Frame>
                                        <!-- Product Name -->
                                        <Frame CornerRadius="15" BackgroundColor="White" Padding="5,2" Margin="0,5,0,0" HasShadow="False" HorizontalOptions="Center">
                                            <Label Text="{Binding ProductName}" FontAttributes="Bold" FontSize="14" HorizontalOptions="Center" VerticalOptions="Center"/>
                                        </Frame>
                                        <!-- Price -->
                                        <HorizontalStackLayout HorizontalOptions="Center">
                                            <Label Text="{Binding SmallPrice, StringFormat='₱{0:F2}'}" FontSize="13"/>
                                            <Label Text=" | " FontSize="13"/>
                                            <Label Text="{Binding LargePrice, StringFormat='₱{0:F2}'}" FontSize="13"/>
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Border>

                <!-- Cart -->
                <Frame Grid.Column="1" 
                       CornerRadius="20" 
                       BackgroundColor="White" 
                       Margin="0,25,0,0"
                       VerticalOptions="Start"
                       HeightRequest="550"
                       HorizontalOptions="FillAndExpand"> 
                    <VerticalStackLayout>
                        <Frame>
                            <Label Text="EMPTY" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center" 
                                   FontSize="40" 
                                   FontAttributes="Bold" 
                                   TextColor="#534F4F" 
                                   FontFamily="Roboto" />
                        </Frame>

                        <Button Text="Check Out" 
                                HeightRequest="50" 
                                HorizontalOptions="End" 
                                VerticalOptions="End" 
                                Margin="20" 
                                FontAttributes="Bold" 
                                FontSize="16" 
                                TextColor="White">
                            <Button.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#A57C5C" Offset="0.0" />
                                    <GradientStop Color="#5B4F45" Offset="1.0" />
                                </LinearGradientBrush>
                            </Button.Background>
                            <Button.Shadow>
                                <Shadow Brush="#000000" Opacity="0.3" Offset="4,4" />
                            </Button.Shadow>
                            <Button.CornerRadius>25</Button.CornerRadius>
                        </Button>
                    </VerticalStackLayout>
                </Frame>

            </Grid>
        </Grid>

        <!-- Settings Popup -->
        <view:Settings 
                       BindingContext="{Binding SettingsPopup}" 
                       Grid.ColumnSpan="2"/>

        <!-- Add Item to POS Popup -->
        <otherViews:AddItemToPOS 
                                 BindingContext="{Binding AddItemToPOSViewModel}" 
                                 Grid.ColumnSpan="2"/>
    </Grid>
</ContentPage>
